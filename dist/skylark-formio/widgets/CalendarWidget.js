/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["../vendors/flatpickr/flatpickr","./InputWidget","../utils/utils","skylark-moment","skylark-lodash"],function(t,e,s,i,a){"use strict";return class n extends e{static get defaultSettings(){return{type:"calendar",altInput:!0,allowInput:!0,clickOpens:!0,enableDate:!0,enableTime:!0,mode:"single",noCalendar:!1,format:"yyyy-MM-dd hh:mm a",dateFormat:"yyyy-MM-ddTHH:mm:ssZ",useLocaleSettings:!1,language:"us-en",hourIncrement:1,minuteIncrement:5,time_24hr:!1,saveAs:"date",displayInTimezone:"",timezone:"",disable:[],minDate:"",maxDate:""}}constructor(t,e){super(t,e),this.settings.noCalendar&&(this.settings.format=this.settings.format.replace(/yyyy-MM-dd /g,"")),this.settings.enableTime?this.settings.time_24hr&&(this.settings.format=this.settings.format.replace(/hh:mm a$/g,"HH:mm")):this.settings.format=this.settings.format.replace(/ hh:mm a$/g,"")}loadZones(){const t=this.timezone;return!(s.zonesLoaded()||!s.shouldLoadZones(t))&&(s.loadZones(t).then(()=>this.emit("redraw")),!0)}attach(e){const i=super.attach(e);e&&!e.getAttribute("placeholder")&&e.setAttribute("placeholder",this.settings.format);const a=s.getLocaleDateFormatInfo(this.settings.language);return this.defaultFormat={date:a.dayFirst?"d/m/Y ":"m/d/Y ",time:"G:i K"},this.closedOn=0,this.valueFormat=this.settings.dateFormat||"yyyy-MM-ddTHH:mm:ssZ",this.valueMomentFormat=s.convertFormatToMoment(this.valueFormat),this.settings.minDate=s.getDateSetting(this.settings.minDate),this.settings.disable=this.disabledDates,this.settings.disableWeekends&&this.settings.disable.push(this.disableWeekends),this.settings.disableWeekdays&&this.settings.disable.push(this.disableWeekdays),this.settings.disableFunction&&this.settings.disable.push(this.disableFunction),this.settings.maxDate=s.getDateSetting(this.settings.maxDate),this.settings.altFormat=s.convertFormatToFlatpickr(this.settings.format),this.settings.dateFormat=s.convertFormatToFlatpickr(this.settings.dateFormat),this.settings.onChange=(()=>this.emit("update")),this.settings.onClose=(()=>{this.closedOn=Date.now(),this.calendar&&this.emit("blur")}),this.settings.undefined=((e,i)=>this.settings.readOnly&&i===this.settings.altFormat?"text"===this.settings.saveAs||this.undefined()?t.undefined(e,i):s.formatOffset(t.undefined.bind(t),e,i,this.timezone):t.undefined(e,i)),this._input&&(this.calendar=new t(this._input,this.settings),this.setInputMask(this.calendar._input,s.convertFormatToMask(this.settings.format)),this.addEventListener(this.calendar._input,"blur",()=>this.calendar.setDate(this.calendar._input.value,!0,this.settings.altFormat))),i}get disableWeekends(){return function(t){return 0===t.getDay()||6===t.getDay()}}get disableWeekdays(){return t=>!this.disableWeekends(t)}get disableFunction(){return t=>this.evaluate(`return ${this.settings.disableFunction}`,{date:t})}get timezone(){return this.settings.timezone?this.settings.timezone:"submission"===this.settings.displayInTimezone&&this.settings.submissionTimezone?this.settings.submissionTimezone:"utc"===this.settings.displayInTimezone?"UTC":s.currentTimezone()}get defaultSettings(){return n.defaultSettings}addSuffix(t){return this.addEventListener(t,"click",()=>{this.calendar&&!this.calendar.isOpen&&Date.now()-this.closedOn>200&&this.calendar.open()}),t}set disabled(t){super.disabled=t,this.calendar&&(t?this.calendar._input.setAttribute("disabled","disabled"):this.calendar._input.removeAttribute("disabled"),this.calendar.close(),this.calendar.redraw())}get input(){return this.calendar?this.calendar.altInput:null}get disabledDates(){if(this.settings.disabledDates){return this.settings.disabledDates.split(",").map(t=>{const e=/\d{4}-\d{2}-\d{2}/g,s=t.match(e);if(s.length)return 1===s.length?t.match(e)[0]:{from:t.match(e)[0],to:t.match(e)[1]}})}return[]}get localeFormat(){let t="";return this.settings.enableDate&&(t+=this.defaultFormat.date),this.settings.enableTime&&(t+=this.defaultFormat.time),t}get dateTimeFormat(){return this.settings.useLocaleSettings?this.localeFormat:s.convertFormatToFlatpickr(this.dateFormat)}get dateFormat(){return a.get(this.settings,"format","yyyy-MM-dd hh:mm a")}getDateValue(t,e){return i(t).format(s.convertFormatToMoment(e))}getValue(){if(!this.calendar)return super.getValue();const t=this.calendar.selectedDates;return t&&t.length?t[0]instanceof Date?this.getDateValue(t[0],this.valueFormat):"Invalid Date":super.getValue()}setValue(t){if(!this.calendar)return super.setValue(t);t?"text"!==this.settings.saveAs&&this.settings.readOnly&&!this.undefined()?this.calendar.setDate(s.momentDate(t,this.valueFormat,this.timezone).toDate(),!1):this.calendar.setDate(i(t,this.valueMomentFormat).toDate(),!1):this.calendar.clear(!1)}getValueAsString(t,e){return e=e||this.dateFormat,"text"===this.settings.saveAs?this.getDateValue(t,e):s.formatDate(t,e,this.timezone)}validationValue(t){return"string"==typeof t?new Date(t):t.map(t=>new Date(t))}destroy(){super.destroy(),this.calendar&&this.calendar.destroy()}}});
//# sourceMappingURL=../sourcemaps/widgets/CalendarWidget.js.map

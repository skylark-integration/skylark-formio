{"version":3,"sources":["Webform.js"],"names":["define","_","moment","EventEmitter","i18next","Formio","NativePromise","Components","NestedDataComponent","a","b","forms","registerComponent","setComponent","[object Object]","element","options","arguments","HTMLElement","super","icons","defaults","submitOnEnter","iconset","saveDraft","alwaysDirty","saveDraftThrottle","events","wildcard","maxListeners","getOptions","this","id","baseUrl","setBaseUrl","i18n","require","default","i18nReady","resources","each","lang","code","merge","assign","translation","language","lng","type","_src","_loading","_form","draftEnabled","savingDraft","triggerSaveDraft","throttle","bind","customErrors","nosubmit","submitted","submitting","formio","loader","alert","onSubmission","submissionSet","formReady","resolve","reject","formReadyResolve","formReadyReject","submissionReady","submissionReadyResolve","submissionReadyReject","shortcuts","localize","then","on","user","restoreDraft","_id","component","clearOnHide","root","changeLanguage","err","redraw","emit","active","addResourceBundle","initialized","init","split","nodeName","indexOf","event","target","keyboardCatchableElement","ctrl","ctrlKey","metaKey","keyCode","char","String","fromCharCode","shortcut","click","preventDefault","test","capitalize","tagName","push","remove","src","loadingSubmission","submissionId","loadSubmission","submission","setSubmission","catch","value","setUrl","loadForm","params","live","form","setForm","console","warn","setSrc","url","ready","loading","ce","class","spinner","appendChild","prependTo","wrapper","removeChildFrom","settings","components","module","formModule","evaluate","use","Object","rebuild","triggerRecaptcha","setTimeout","onChange","getValue","flags","fromSubmission","triggerChange","setValue","getUser","draft","state","saveSubmission","sub","currentSubmission","userId","loadSubmissions","owner","submissions","length","skipDraftRestore","fastCloneDeep","schema","omit","undefined","_this","_that","mergeWith","thisValue","thatValue","Array","isArray","data","_submission","metadata","editing","submissionTimezone","timezone","changed","sanitize","mergeData","viewOnly","destroyComponents","input","addComponents","submit","e","log","checkValidity","args","submitUrl","headers","resetValue","deleteSubmission","updateValue","executeFormController","controller","visible","hidden","rootPristine","off","destroy","build","render","renderTemplate","classes","getClassName","children","renderComponents","builderMode","clear","setContent","attach","loadRefs","webform","childPromise","attachComponents","refs","addEventListener","executeShortcuts","currentForm","noUpdateEvent","result","eachComponent","validate","required","getComponents","comp","setPristine","message","noAlerts","errorRef","forEach","el","removeEventListener","removeChild","role","appendTo","key","currentTarget","dataset","componentKey","focusOnComponent","prepend","getComponent","focus","error","triggerEvent","errors","concat","setAlert","path","identity","compact","setCustomValidity","document","createDocumentFragment","p","t","ul","createListItem","ref","tabIndex","aria-label","li","messages","label","isObject","saved","noValidate","noCheck","details","silent","isValid","showErrors","modified","isChangeEventEmitted","filter","clone","pristine","checkData","noEmit","valid","isEmpty","noconfirm","hook","confirm","readOnly","get","currentTimezone","offset","parseInt","utcOffset","referrer","browserName","navigator","appName","userAgent","pathName","window","location","pathname","onLine","isDraft","everyComponent","persistent","unset","action","method","includes","makeStaticRequest","submitFormio","actionUrl","submitForm","onSubmit","onSubmissionError","before","executeSubmit","beforeSubmit","URL","API_URL","map","header","interpolate","statusText","status","recaptchaComponent","find","eventType","verify","name","_nosubmit"],"mappings":"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","file":"../Webform.js","sourcesContent":["define([\n    'skylark-lodash',\n    'skylark-moment',\n    './EventEmitter',\n    'skylark-i18next',\n    './Formio',\n    './vendors/getify/npo',\n    './components/Components',\n    './components/_classes/nesteddata/NestedDataComponent',\n    './utils/utils',\n    './utils/formUtils'\n], function (_, moment, EventEmitter, i18next, Formio, NativePromise, Components, NestedDataComponent, a, b) {\n    'use strict';\n    Formio.forms = {};\n    Formio.registerComponent = Components.setComponent;\n    function getIconSet(icons) {\n        if (icons === 'fontawesome') {\n            return 'fa';\n        }\n        return icons || '';\n    }\n    function getOptions(options) {\n        options = _.defaults(options, {\n            submitOnEnter: false,\n            iconset: getIconSet(options && options.icons ? options.icons : Formio.icons),\n            i18next,\n            saveDraft: false,\n            alwaysDirty: false,\n            saveDraftThrottle: 5000\n        });\n        if (!options.events) {\n            options.events = new EventEmitter({\n                wildcard: false,\n                maxListeners: 0\n            });\n        }\n        return options;\n    }\n    return class Webform extends NestedDataComponent {\n        constructor() {\n            let element, options;\n            if (arguments[0] instanceof HTMLElement || arguments[1]) {\n                element = arguments[0];\n                options = arguments[1];\n            } else {\n                options = arguments[0];\n            }\n            super(null, getOptions(options));\n            this.element = element;\n            Formio.forms[this.id] = this;\n            if (this.options.baseUrl) {\n                Formio.setBaseUrl(this.options.baseUrl);\n            }\n            let i18n = require('./i18n').default;\n            if (options && options.i18n && !options.i18nReady) {\n                if (options.i18n.resources) {\n                    i18n = options.i18n;\n                } else {\n                    _.each(options.i18n, (lang, code) => {\n                        if (code === 'options') {\n                            _.merge(i18n, lang);\n                        } else if (!i18n.resources[code]) {\n                            i18n.resources[code] = { translation: lang };\n                        } else {\n                            _.assign(i18n.resources[code].translation, lang);\n                        }\n                    });\n                }\n                options.i18n = i18n;\n                options.i18nReady = true;\n            }\n            if (options && options.i18n) {\n                this.options.i18n = options.i18n;\n            } else {\n                this.options.i18n = i18n;\n            }\n            if (this.options.language) {\n                this.options.i18n.lng = this.options.language;\n            }\n            this.type = 'form';\n            this._src = '';\n            this._loading = false;\n            this._form = {};\n            this.draftEnabled = false;\n            this.savingDraft = true;\n            if (this.options.saveDraftThrottle) {\n                this.triggerSaveDraft = _.throttle(this.saveDraft.bind(this), this.options.saveDraftThrottle);\n            } else {\n                this.triggerSaveDraft = this.saveDraft.bind(this);\n            }\n            this.customErrors = [];\n            this.nosubmit = false;\n            this.submitted = false;\n            this.submitting = false;\n            this.formio = null;\n            this.loader = null;\n            this.alert = null;\n            this.onSubmission = null;\n            this.submissionSet = false;\n            this.formReady = new NativePromise((resolve, reject) => {\n                this.formReadyResolve = resolve;\n                this.formReadyReject = reject;\n            });\n            this.submissionReady = new NativePromise((resolve, reject) => {\n                this.submissionReadyResolve = resolve;\n                this.submissionReadyReject = reject;\n            });\n            this.shortcuts = [];\n            this.localize().then(() => {\n                this.language = this.options.language;\n            });\n            if (this.options.saveDraft && Formio.events) {\n                Formio.events.on('formio.user', user => {\n                    this.formReady.then(() => {\n                        if (!this.submissionSet) {\n                            this.restoreDraft(user._id);\n                        }\n                    });\n                });\n            }\n            this.component.clearOnHide = false;\n            this.root = this;\n        }\n        set language(lang) {\n            return new NativePromise((resolve, reject) => {\n                this.options.language = lang;\n                if (i18next.language === lang) {\n                    return resolve();\n                }\n                try {\n                    i18next.changeLanguage(lang, err => {\n                        if (err) {\n                            return reject(err);\n                        }\n                        this.redraw();\n                        this.emit('languageChanged');\n                        resolve();\n                    });\n                } catch (err) {\n                    return reject(err);\n                }\n            });\n        }\n        addLanguage(code, lang, active = false) {\n            i18next.addResourceBundle(code, 'translation', lang, true, true);\n            if (active) {\n                this.language = code;\n            }\n        }\n        localize() {\n            if (i18next.initialized) {\n                return NativePromise.resolve(i18next);\n            }\n            i18next.initialized = true;\n            return new NativePromise((resolve, reject) => {\n                try {\n                    i18next.init(this.options.i18n, err => {\n                        this.options.language = i18next.language.split(';')[0];\n                        if (err) {\n                            return reject(err);\n                        }\n                        resolve(i18next);\n                    });\n                } catch (err) {\n                    return reject(err);\n                }\n            });\n        }\n        keyboardCatchableElement(element) {\n            if (element.nodeName === 'TEXTAREA') {\n                return false;\n            }\n            if (element.nodeName === 'INPUT') {\n                return [\n                    'text',\n                    'email',\n                    'password'\n                ].indexOf(element.type) === -1;\n            }\n            return true;\n        }\n        executeShortcuts(event) {\n            const {target} = event;\n            if (!this.keyboardCatchableElement(target)) {\n                return;\n            }\n            const ctrl = event.ctrlKey || event.metaKey;\n            const keyCode = event.keyCode;\n            let char = '';\n            if (65 <= keyCode && keyCode <= 90) {\n                char = String.fromCharCode(keyCode);\n            } else if (keyCode === 13) {\n                char = 'Enter';\n            } else if (keyCode === 27) {\n                char = 'Esc';\n            }\n            _.each(this.shortcuts, shortcut => {\n                if (shortcut.ctrl && !ctrl) {\n                    return;\n                }\n                if (shortcut.shortcut === char) {\n                    shortcut.element.click();\n                    event.preventDefault();\n                }\n            });\n        }\n        addShortcut(element, shortcut) {\n            if (!shortcut || !/^([A-Z]|Enter|Esc)$/i.test(shortcut)) {\n                return;\n            }\n            shortcut = _.capitalize(shortcut);\n            if (shortcut === 'Enter' || shortcut === 'Esc') {\n                if (element.tagName !== 'BUTTON') {\n                    return;\n                }\n                this.shortcuts.push({\n                    shortcut,\n                    element\n                });\n            } else {\n                this.shortcuts.push({\n                    ctrl: true,\n                    shortcut,\n                    element\n                });\n            }\n        }\n        removeShortcut(element, shortcut) {\n            if (!shortcut || !/^([A-Z]|Enter|Esc)$/i.test(shortcut)) {\n                return;\n            }\n            _.remove(this.shortcuts, {\n                shortcut,\n                element\n            });\n        }\n        get src() {\n            return this._src;\n        }\n        loadSubmission() {\n            this.loadingSubmission = true;\n            if (this.formio.submissionId) {\n                this.onSubmission = this.formio.loadSubmission().then(submission => this.setSubmission(submission), err => this.submissionReadyReject(err)).catch(err => this.submissionReadyReject(err));\n            } else {\n                this.submissionReadyResolve();\n            }\n            return this.submissionReady;\n        }\n        setSrc(value, options) {\n            if (this.setUrl(value, options)) {\n                this.nosubmit = false;\n                return this.formio.loadForm({ params: { live: 1 } }).then(form => {\n                    const setForm = this.setForm(form);\n                    this.loadSubmission();\n                    return setForm;\n                }).catch(err => {\n                    console.warn(err);\n                    this.formReadyReject(err);\n                });\n            }\n            return NativePromise.resolve();\n        }\n        set src(value) {\n            this.setSrc(value);\n        }\n        get url() {\n            return this._src;\n        }\n        setUrl(value, options) {\n            if (!value || typeof value !== 'string' || value === this._src) {\n                return false;\n            }\n            this._src = value;\n            this.nosubmit = true;\n            this.formio = this.options.formio = new Formio(value, options);\n            if (this.type === 'form') {\n                this.options.src = value;\n            }\n            return true;\n        }\n        set url(value) {\n            this.setUrl(value);\n        }\n        get ready() {\n            return this.formReady.then(() => {\n                return super.ready.then(() => {\n                    return this.loadingSubmission ? this.submissionReady : true;\n                });\n            });\n        }\n        get loading() {\n            return this._loading;\n        }\n        set loading(loading) {\n            if (this._loading !== loading) {\n                this._loading = loading;\n                if (!this.loader && loading) {\n                    this.loader = this.ce('div', { class: 'loader-wrapper' });\n                    const spinner = this.ce('div', { class: 'loader text-center' });\n                    this.loader.appendChild(spinner);\n                }\n                if (this.loader) {\n                    try {\n                        if (loading) {\n                            this.prependTo(this.loader, this.wrapper);\n                        } else {\n                            this.removeChildFrom(this.loader, this.wrapper);\n                        }\n                    } catch (err) {\n                    }\n                }\n            }\n        }\n        setForm(form) {\n            this._form = form;\n            if (form && form.settings && form.settings.components) {\n                this.options.components = form.settings.components;\n            }\n            if (form && form.module) {\n                let formModule = null;\n                if (typeof form.module === 'string') {\n                    try {\n                        formModule = this.evaluate(`return ${ form.module }`);\n                    } catch (err) {\n                        console.warn(err);\n                    }\n                } else {\n                    formModule = form.module;\n                }\n                if (formModule) {\n                    Formio.use(formModule);\n                    if (formModule.options && formModule.options.form) {\n                        this.options = Object.assign(this.options, formModule.options.form);\n                    }\n                }\n            }\n            this.initialized = false;\n            const rebuild = this.rebuild() || NativePromise.resolve();\n            return rebuild.then(() => {\n                this.emit('formLoad', form);\n                this.triggerRecaptcha();\n                setTimeout(() => {\n                    this.onChange();\n                    this.formReadyResolve();\n                }, 0);\n                return this.formReady;\n            });\n        }\n        get form() {\n            if (!this._form) {\n                this._form = { components: [] };\n            }\n            return this._form;\n        }\n        set form(form) {\n            this.setForm(form);\n        }\n        get submission() {\n            return this.getValue();\n        }\n        set submission(submission) {\n            this.setSubmission(submission);\n        }\n        setSubmission(submission, flags = {}) {\n            flags = {\n                ...flags,\n                fromSubmission: true\n            };\n            return this.onSubmission = this.formReady.then(() => {\n                this.submissionSet = true;\n                this.triggerChange(flags);\n                this.setValue(submission, flags);\n                return this.submissionReadyResolve(submission);\n            }, err => this.submissionReadyReject(err)).catch(err => this.submissionReadyReject(err));\n        }\n        saveDraft() {\n            if (!this.draftEnabled) {\n                return;\n            }\n            if (!this.formio) {\n                console.warn('Cannot save draft because there is no formio instance.');\n                return;\n            }\n            if (!Formio.getUser()) {\n                console.warn('Cannot save draft unless a user is authenticated.');\n                return;\n            }\n            const draft = this.submission;\n            draft.state = 'draft';\n            if (!this.savingDraft) {\n                this.savingDraft = true;\n                this.formio.saveSubmission(draft).then(sub => {\n                    const currentSubmission = _.merge(sub, draft);\n                    this.emit('saveDraft', sub);\n                    if (!draft._id) {\n                        this.setSubmission(currentSubmission).then(() => {\n                            this.savingDraft = false;\n                        });\n                    } else {\n                        this.savingDraft = false;\n                    }\n                });\n            }\n        }\n        restoreDraft(userId) {\n            if (!this.formio) {\n                console.warn('Cannot restore draft because there is no formio instance.');\n                return;\n            }\n            this.savingDraft = true;\n            this.formio.loadSubmissions({\n                params: {\n                    state: 'draft',\n                    owner: userId\n                }\n            }).then(submissions => {\n                if (submissions.length > 0 && !this.options.skipDraftRestore) {\n                    const draft = a.fastCloneDeep(submissions[0]);\n                    return this.setSubmission(draft).then(() => {\n                        this.draftEnabled = true;\n                        this.savingDraft = false;\n                        this.emit('restoreDraft', draft);\n                    });\n                }\n                this.draftEnabled = true;\n                this.savingDraft = false;\n                this.emit('restoreDraft', null);\n            });\n        }\n        get schema() {\n            const schema = a.fastCloneDeep(_.omit(this._form, ['components']));\n            schema.components = [];\n            this.undefined(component => schema.components.push(component.schema));\n            return schema;\n        }\n        mergeData(_this, _that) {\n            _.mergeWith(_this, _that, (thisValue, thatValue) => {\n                if (Array.isArray(thisValue) && Array.isArray(thatValue) && thisValue.length !== thatValue.length) {\n                    return thatValue;\n                }\n            });\n        }\n        setValue(submission, flags = {}) {\n            if (!submission || !submission.data) {\n                submission = { data: {} };\n            }\n            this._submission.metadata = submission.metadata || {};\n            this.editing = !!submission._id;\n            if (!this.options.submissionTimezone && submission.metadata && submission.metadata.timezone) {\n                this.options.submissionTimezone = submission.metadata.timezone;\n            }\n            const changed = super.setValue(submission.data, flags);\n            if (!flags.sanitize) {\n                this.mergeData(this.data, submission.data);\n            }\n            submission.data = this.data;\n            this._submission = submission;\n            return changed;\n        }\n        getValue() {\n            if (!this._submission.data) {\n                this._submission.data = {};\n            }\n            if (this.viewOnly) {\n                return this._submission;\n            }\n            const submission = this._submission;\n            submission.data = this.data;\n            return this._submission;\n        }\n        init() {\n            this._submission = this._submission || { data: {} };\n            if (this.components && this.components.length) {\n                this.destroyComponents();\n                this.components = [];\n            }\n            if (this.component) {\n                this.component.components = this.form ? this.form.components : [];\n            } else {\n                this.component = this.form;\n            }\n            this.component.type = 'form';\n            this.component.input = false;\n            this.addComponents();\n            this.on('submitButton', options => {\n                this.submit(false, options).catch(e => e !== false && console.log(e));\n            }, true);\n            this.on('checkValidity', data => this.checkValidity(data, true, data), true);\n            this.on('requestUrl', args => this.submitUrl(args.url, args.headers), true);\n            this.on('resetForm', () => this.resetValue(), true);\n            this.on('deleteSubmission', () => this.deleteSubmission(), true);\n            this.on('refreshData', () => this.updateValue(), true);\n            this.executeFormController();\n            return this.formReady;\n        }\n        executeFormController() {\n            if (!this.form || !this.form.controller || (!this.visible || this.component.hidden) && this.component.clearOnHide && !this.rootPristine) {\n                return false;\n            }\n            this.formReady.then(() => {\n                this.evaluate(this.form.controller, { components: this.components });\n            });\n        }\n        destroy() {\n            this.off('submitButton');\n            this.off('checkValidity');\n            this.off('requestUrl');\n            this.off('resetForm');\n            this.off('deleteSubmission');\n            this.off('refreshData');\n            return super.destroy();\n        }\n        build(element) {\n            if (element || this.element) {\n                return this.ready.then(() => {\n                    element = element || this.element;\n                    super.build(element);\n                });\n            }\n            return this.ready;\n        }\n        getClassName() {\n            return 'formio-form';\n        }\n        render() {\n            return super.render(this.renderTemplate('webform', {\n                classes: this.getClassName(),\n                children: this.renderComponents()\n            }), this.builderMode ? 'builder' : 'form', true);\n        }\n        redraw() {\n            if (!this.element) {\n                return NativePromise.resolve();\n            }\n            this.clear();\n            this.setContent(this.element, this.render());\n            return this.attach(this.element);\n        }\n        attach(element) {\n            this.element = element;\n            this.loadRefs(element, { webform: 'single' });\n            const childPromise = this.attachComponents(this.refs.webform);\n            this.addEventListener(this.element, 'keydown', this.executeShortcuts);\n            this.currentForm = this;\n            return childPromise.then(() => {\n                this.emit('render');\n                return this.setValue(this._submission, { noUpdateEvent: true });\n            });\n        }\n        hasRequiredFields() {\n            let result = false;\n            b.eachComponent(this.form.components, component => {\n                if (component.validate.required) {\n                    result = true;\n                    return true;\n                }\n            }, true);\n            return result;\n        }\n        resetValue() {\n            _.each(this.getComponents(), comp => comp.resetValue());\n            this.setPristine(true);\n        }\n        setAlert(type, message) {\n            if (!type && this.submitted) {\n                if (this.alert) {\n                    if (this.refs.errorRef && this.refs.errorRef.length) {\n                        this.refs.errorRef.forEach(el => {\n                            this.removeEventListener(el, 'click');\n                            this.removeEventListener(el, 'keypress');\n                        });\n                    }\n                    this.removeChild(this.alert);\n                    this.alert = null;\n                }\n                return;\n            }\n            if (this.options.noAlerts) {\n                if (!message) {\n                    this.emit('error', false);\n                }\n                return;\n            }\n            if (this.alert) {\n                try {\n                    if (this.refs.errorRef && this.refs.errorRef.length) {\n                        this.refs.errorRef.forEach(el => {\n                            this.removeEventListener(el, 'click');\n                            this.removeEventListener(el, 'keypress');\n                        });\n                    }\n                    this.removeChild(this.alert);\n                    this.alert = null;\n                } catch (err) {\n                }\n            }\n            if (message) {\n                this.alert = this.ce('div', {\n                    id: `error-list-${ this.id }`,\n                    class: `alert alert-${ type }`,\n                    role: 'alert'\n                });\n                if (message instanceof HTMLElement) {\n                    this.appendTo(message, this.alert);\n                } else {\n                    this.setContent(this.alert, message);\n                }\n            }\n            if (!this.alert) {\n                return;\n            }\n            this.loadRefs(this.alert, { errorRef: 'multiple' });\n            if (this.refs.errorRef && this.refs.errorRef.length) {\n                this.refs.errorRef.forEach(el => {\n                    this.addEventListener(el, 'click', e => {\n                        const key = e.currentTarget.dataset.componentKey;\n                        this.focusOnComponent(key);\n                    });\n                    this.addEventListener(el, 'keypress', e => {\n                        if (e.keyCode === 13) {\n                            const key = e.currentTarget.dataset.componentKey;\n                            this.focusOnComponent(key);\n                        }\n                    });\n                });\n            }\n            this.prepend(this.alert);\n        }\n        focusOnComponent(key) {\n            if (key) {\n                const component = this.getComponent(key);\n                if (component) {\n                    component.focus();\n                }\n            }\n        }\n        showErrors(error, triggerEvent) {\n            this.loading = false;\n            let errors = this.errors;\n            if (error) {\n                if (Array.isArray(error)) {\n                    errors = errors.concat(error);\n                } else {\n                    errors.push(error);\n                }\n            } else {\n                errors = super.errors;\n            }\n            errors = errors.concat(this.customErrors);\n            if (!errors.length) {\n                this.setAlert(false);\n                return;\n            }\n            errors.forEach(err => {\n                const {\n                    components = []\n                } = err;\n                if (err.component) {\n                    components.push(err.component);\n                }\n                if (err.path) {\n                    components.push(err.path);\n                }\n                components.forEach(path => {\n                    const component = this.getComponent(path, _.identity);\n                    const components = _.compact(Array.isArray(component) ? component : [component]);\n                    components.forEach(component => component.setCustomValidity(err.message, true));\n                });\n            });\n            const message = document.createDocumentFragment();\n            const p = this.ce('p');\n            this.setContent(p, this.t('error'));\n            const ul = this.ce('ul');\n            errors.forEach(err => {\n                if (err) {\n                    const createListItem = message => {\n                        const params = {\n                            ref: 'errorRef',\n                            tabIndex: 0,\n                            'aria-label': `${ message }. Click to navigate to the field with following error.`\n                        };\n                        const li = this.ce('li', params);\n                        this.setContent(li, message);\n                        if (err.component && err.component.key) {\n                            li.dataset.componentKey = err.component.key;\n                        }\n                        this.appendTo(li, ul);\n                    };\n                    if (err.messages && err.messages.length) {\n                        err.messages.forEach(({message}) => createListItem(`${ this.t(err.component.label) }. ${ message }`));\n                    } else if (err) {\n                        const message = _.isObject(err) ? err.message || '' : err;\n                        createListItem(message);\n                    }\n                }\n            });\n            p.appendChild(ul);\n            message.appendChild(p);\n            this.setAlert('danger', message);\n            if (triggerEvent) {\n                this.emit('error', errors);\n            }\n            return errors;\n        }\n        onSubmit(submission, saved) {\n            this.loading = false;\n            this.submitting = false;\n            this.setPristine(true);\n            this.setValue(a.fastCloneDeep(submission), {\n                noValidate: true,\n                noCheck: true\n            });\n            this.setAlert('success', `<p>${ this.t('complete') }</p>`);\n            this.emit('submit', submission);\n            if (saved) {\n                this.emit('submitDone', submission);\n            }\n            return submission;\n        }\n        onSubmissionError(error) {\n            if (error) {\n                if (typeof error === 'string') {\n                    error = { message: error };\n                }\n                if ('details' in error) {\n                    error = error.details;\n                }\n            }\n            this.submitting = false;\n            this.setPristine(false);\n            this.emit('submitError', error);\n            if (error && error.silent) {\n                this.emit('change', { isValid: true });\n                return false;\n            }\n            return this.showErrors(error, true);\n        }\n        onChange(flags, changed, modified) {\n            flags = flags || {};\n            let isChangeEventEmitted = false;\n            if (changed && changed.component) {\n                this.customErrors = this.customErrors.filter(err => err.component && err.component !== changed.component.key);\n            }\n            super.onChange(flags, true);\n            const value = _.clone(this.submission);\n            flags.changed = value.changed = changed;\n            if (modified && this.pristine) {\n                this.pristine = false;\n            }\n            value.isValid = this.checkData(value.data, flags);\n            this.loading = false;\n            if (this.submitted) {\n                this.showErrors();\n            }\n            if (modified && this.options.saveDraft) {\n                this.triggerSaveDraft();\n            }\n            if (!flags || !flags.noEmit) {\n                this.emit('change', value, flags);\n                isChangeEventEmitted = true;\n            }\n            if (isChangeEventEmitted && !this.initialized) {\n                this.emit('initialized');\n                this.initialized = true;\n            }\n        }\n        checkData(data, flags = {}) {\n            const valid = super.checkData(data, flags);\n            if ((_.isEmpty(flags) || flags.noValidate) && this.submitted) {\n                this.showErrors();\n            }\n            return valid;\n        }\n        deleteSubmission() {\n            return this.formio.deleteSubmission().then(() => {\n                this.emit('submissionDeleted', this.submission);\n                this.resetValue();\n            });\n        }\n        cancel(noconfirm) {\n            const shouldReset = this.hook('beforeCancel', true);\n            if (shouldReset && (noconfirm || confirm('Are you sure you want to cancel?'))) {\n                this.resetValue();\n                return true;\n            } else {\n                return false;\n            }\n        }\n        submitForm(options = {}) {\n            return new NativePromise((resolve, reject) => {\n                if (this.options.readOnly) {\n                    return resolve({\n                        submission: this.submission,\n                        saved: false\n                    });\n                }\n                const submission = a.fastCloneDeep(this.submission || {});\n                submission.metadata = submission.metadata || {};\n                _.defaults(submission.metadata, {\n                    timezone: _.get(this, '_submission.metadata.timezone', a.currentTimezone()),\n                    offset: parseInt(_.get(this, '_submission.metadata.offset', moment().utcOffset()), 10),\n                    referrer: document.referrer,\n                    browserName: navigator.appName,\n                    userAgent: navigator.userAgent,\n                    pathName: window.location.pathname,\n                    onLine: navigator.onLine\n                });\n                submission.state = options.state || 'submitted';\n                const isDraft = submission.state === 'draft';\n                this.hook('beforeSubmit', {\n                    ...submission,\n                    component: options.component\n                }, err => {\n                    if (err) {\n                        return reject(err);\n                    }\n                    if (!isDraft && !submission.data) {\n                        return reject('Invalid Submission');\n                    }\n                    if (!isDraft && !this.checkValidity(submission.data, true, submission.data)) {\n                        return reject();\n                    }\n                    this.everyComponent(comp => {\n                        const {persistent} = comp.component;\n                        if (persistent === 'client-only') {\n                            _.unset(submission.data, comp.path);\n                        }\n                    });\n                    this.hook('customValidation', {\n                        ...submission,\n                        component: options.component\n                    }, err => {\n                        if (err) {\n                            if (typeof err === 'string') {\n                                err = { message: err };\n                            }\n                            err = Array.isArray(err) ? err : [err];\n                            this.customErrors = err;\n                            return reject();\n                        }\n                        this.loading = true;\n                        if (this._form && this._form.action) {\n                            const method = submission.data._id && this._form.action.includes(submission.data._id) ? 'PUT' : 'POST';\n                            return Formio.makeStaticRequest(this._form.action, method, submission, this.formio ? this.formio.options : {}).then(result => resolve({\n                                submission: result,\n                                saved: true\n                            })).catch(reject);\n                        }\n                        const submitFormio = this.formio;\n                        if (this.nosubmit || !submitFormio) {\n                            return resolve({\n                                submission,\n                                saved: false\n                            });\n                        }\n                        const submitMethod = submitFormio.actionUrl ? 'saveAction' : 'saveSubmission';\n                        submitFormio[submitMethod](submission).then(result => resolve({\n                            submission: result,\n                            saved: true\n                        })).catch(reject);\n                    });\n                });\n            });\n        }\n        executeSubmit(options) {\n            this.submitted = true;\n            this.submitting = true;\n            return this.submitForm(options).then(({submission, saved}) => this.onSubmit(submission, saved)).catch(err => NativePromise.reject(this.onSubmissionError(err)));\n        }\n        submit(before, options) {\n            if (!before) {\n                return this.beforeSubmit(options).then(() => this.executeSubmit(options));\n            } else {\n                return this.executeSubmit(options);\n            }\n        }\n        submitUrl(URL, headers) {\n            if (!URL) {\n                return console.warn('Missing URL argument');\n            }\n            const submission = this.submission || {};\n            const API_URL = URL;\n            const settings = {\n                method: 'POST',\n                headers: {}\n            };\n            if (headers && headers.length > 0) {\n                headers.map(e => {\n                    if (e.header !== '' && e.value !== '') {\n                        settings.headers[e.header] = this.interpolate(e.value, submission);\n                    }\n                });\n            }\n            if (API_URL && settings) {\n                try {\n                    Formio.makeStaticRequest(API_URL, settings.method, submission, { headers: settings.headers }).then(() => {\n                        this.emit('requestDone');\n                        this.setAlert('success', '<p> Success </p>');\n                    });\n                } catch (e) {\n                    this.showErrors(`${ e.statusText } ${ e.status }`);\n                    this.emit('error', `${ e.statusText } ${ e.status }`);\n                    console.error(`${ e.statusText } ${ e.status }`);\n                }\n            } else {\n                this.emit('error', 'You should add a URL to this button.');\n                this.setAlert('warning', 'You should add a URL to this button.');\n                return console.warn('You should add a URL to this button.');\n            }\n        }\n        triggerRecaptcha() {\n            if (!this || !this.components) {\n                return;\n            }\n            const recaptchaComponent = this.components.find(component => {\n                return component.component.type === 'recaptcha' && component.component.eventType === 'formLoad';\n            });\n            if (recaptchaComponent) {\n                recaptchaComponent.verify(`${ this.form.name ? this.form.name : 'form' }Load`);\n            }\n        }\n        set nosubmit(value) {\n            this._nosubmit = !!value;\n            this.emit('nosubmit', this._nosubmit);\n        }\n        get nosubmit() {\n            return this._nosubmit || false;\n        }\n    };\n    Webform.setBaseUrl = Formio.setBaseUrl;\n    Webform.setApiUrl = Formio.setApiUrl;\n    Webform.setAppUrl = Formio.setAppUrl;\n});"]}
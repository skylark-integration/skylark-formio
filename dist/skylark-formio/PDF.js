/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["./vendors/getify/npo","./Formio","./Webform","./utils/utils"],function(e,t,s,i){"use strict";return class extends s{constructor(e,t){super(e,t),this.components=[]}init(){super.init(),this.on("iframe-submission",e=>this.setValue(e,{fromIframe:!0}),!0),this.on("iframe-change",e=>this.setValue(e,{fromIframe:!0}),!0),this.on("iframe-getIframePositions",()=>{const e=document.querySelector("iframe").getBoundingClientRect();this.postMessage({name:"iframePositions",data:{iframe:{top:e.top},scrollY:window.scrollY||window.pageYOffset}})}),this.on("iframe-ready",()=>this.iframeReadyResolve(),!0)}render(){return this.renderTemplate("pdf",{classes:"formio-form-pdf",children:this.renderComponents()})}redraw(){return super.redraw()}attach(t){return super.attach(t).then(()=>{this.loadRefs(t,{submitButton:"single",zoomIn:"single",zoomOut:"single",iframeContainer:"single"}),this.iframeReady=new e((e,t)=>{this.iframeReadyResolve=e,this.iframeReadyReject=t}),this.iframeElement=this.ce("iframe",{src:this.getSrc(),id:`iframe-${this.id}`,seamless:!0,class:"formio-iframe"}),this.iframeElement.formioContainer=this.component.components,this.iframeElement.formioComponent=this,this.empty(this.refs.iframeContainer),this.appendChild(this.refs.iframeContainer,this.iframeElement),this.postMessage({name:"form",data:this.form});const s=this.components.find(e=>e.element===this.refs.submitButton);this.refs.submitButton.classList.toggle("hidden",!s.visible),this.addEventListener(this.refs.submitButton,"click",()=>(this.postMessage({name:"getErrors"}),this.submit())),this.addEventListener(this.refs.zoomIn,"click",e=>{e.preventDefault(),this.postMessage({name:"zoomIn"})}),this.addEventListener(this.refs.zoomOut,"click",e=>{e.preventDefault(),this.postMessage({name:"zoomOut"})});const o=i.fastCloneDeep(this.form);this.formio&&(o.projectUrl=this.formio.projectUrl,o.url=this.formio.formUrl,o.base=this.formio.base,this.postMessage({name:"token",data:this.formio.getToken()})),this.emit("attach")})}getSubmission(){return new e(e=>{this.once("iframe-submission",e),this.postMessage({name:"getSubmission"})})}submitForm(e={}){return this.getSubmission().then(()=>super.submitForm(e))}getSrc(){if(!this._form||!this._form.settings||!this._form.settings.pdf)return"";let e=`${this._form.settings.pdf.src}.html`;const t=[`id=${this.id}`];return this.options.readOnly&&t.push("readonly=1"),this.options.zoom&&t.push(`zoom=${this.options.zoom}`),this.builderMode&&t.push("builder=1"),t.length&&(e+=`?${t.join("&")}`),e}setForm(e){return super.setForm(e).then(()=>{this.formio&&(e.projectUrl=this.formio.projectUrl,e.url=this.formio.formUrl,e.base=this.formio.base,this.postMessage({name:"token",data:this.formio.getToken()})),this.postMessage({name:"form",data:e})})}setValue(e,t={}){const s=super.setValue(e,t);return t&&t.fromIframe||this.once("iframe-ready",()=>{this.postMessage({name:"submission",data:e})}),s}setSubmission(e){return e.readOnly=!!this.options.readOnly,super.setSubmission(e).then(()=>{this.formio&&this.formio.getDownloadUrl().then(e=>{e&&(this.downloadButton||(this.options.primaryProject&&(e+=`&project=${this.options.primaryProject}`),this.downloadButton=this.ce("a",{href:e,target:"_blank",style:"position:absolute;right:10px;top:110px;cursor:pointer;"},this.ce("img",{src:require("./pdf.image"),style:"width:3em;"})),this.element.insertBefore(this.downloadButton,this.iframe)))})})}postMessage(e){this.iframeReady&&(e.type||(e.type="iframe-data"),this.iframeReady.then(()=>{this.iframeElement&&this.iframeElement.contentWindow&&this.iframeElement.contentWindow.postMessage(JSON.stringify(e),"*")}))}focusOnComponent(e){this.postMessage({name:"focusErroredField",data:e})}clear(){}showErrors(e,t){const s=document.getElementById("submit-error");if(!s){const e=this.ce("p",{class:"help-block"});this.setContent(e,this.t("submitError")),e.addEventListener("click",()=>{window.scrollTo(0,0)});const t=this.ce("div",{id:"submit-error",class:"has-error"});this.appendTo(e,t),this.appendTo(t,this.element)}!this.errors.length&&s&&s.remove(),this.errors.length&&this.focusOnComponent(this.errors[0].component.key),this.errors.length&&this.focusOnComponent(this.errors[0].component.key),super.showErrors(e,t)}}});
//# sourceMappingURL=sourcemaps/PDF.js.map

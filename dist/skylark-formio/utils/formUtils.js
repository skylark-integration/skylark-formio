/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["skylark-lodash","../vendors/fast-json-patch/duplex"],function(e,n){"use strict";const{get:o,set:r,has:t,clone:s,forOwn:a,isString:c,isNaN:p,isNil:i,isPlainObject:l,round:u,chunk:y,pad:d}=e;function h(e,n,o,r,t){e&&(r=r||"",e.forEach(e=>{if(!e)return;const a=e.columns&&Array.isArray(e.columns),c=e.rows&&Array.isArray(e.rows),p=e.components&&Array.isArray(e.components);let i=!1;const l=e.key?r?`${r}.${e.key}`:e.key:"";t&&(e.parent=s(t),delete e.parent.components,delete e.parent.componentMap,delete e.parent.columns,delete e.parent.rows),(o||e.tree||!a&&!c&&!p)&&(i=n(e,l));const u=()=>e.key&&!["panel","table","well","columns","fieldset","tabs","form"].includes(e.type)&&(["datagrid","container","editgrid"].includes(e.type)||e.tree)?l:e.key&&"form"===e.type?`${l}.data`:r;i||(a?e.columns.forEach(r=>h(r.components,n,o,u(),t?e:null)):c?e.rows.forEach(r=>{Array.isArray(r)&&r.forEach(r=>h(r.components,n,o,u(),t?e:null))}):p&&h(e.components,n,o,u(),t?e:null))}))}function m(e,n){if(c(n))return e.key===n||e.path===n;{let r=!1;return a(n,(n,t)=>{if(!(r=o(e,t)===n))return!1}),r}}function f(e,n){const o=[];return h(e,e=>{m(e,n)&&o.push(e)},!0),o}function k(e,n,o,r){if(e){if(o=o||[],!n)return r(e);e.forEach(function(e,t){var s=o.slice();s.push(t),e&&(e.hasOwnProperty("columns")&&Array.isArray(e.columns)&&(s.push("columns"),e.columns.forEach(function(e,o){var t=s.slice();t.push(o),t.push("components"),k(e.components,n,t,r)})),e.hasOwnProperty("rows")&&Array.isArray(e.rows)&&(s.push("rows"),e.rows.forEach(function(e,o){var t=s.slice();t.push(o),e.forEach(function(e,o){var s=t.slice();s.push(o),s.push("components"),k(e.components,n,s,r)})})),e.hasOwnProperty("components")&&Array.isArray(e.components)&&(s.push("components"),k(e.components,n,s,r)),e.key===n&&r(e,s))})}}function g(e,n){var r=n.pop();0!==n.length&&(e=o(e,n)),e.splice(r,1)}function A(e){return parseFloat(c(e)?e.replace(/[^\de.+-]/gi,""):e)}return{isLayoutComponent:function(e){return Boolean(e.columns&&Array.isArray(e.columns)||e.rows&&Array.isArray(e.rows)||e.components&&Array.isArray(e.components))},eachComponent:h,matchComponent:m,getComponent:function(e,n,o){let r;return h(e,(e,o)=>{if(o===n||e.path===n)return r=e,!0},o),r},searchComponents:f,findComponents:function(e,n){return console.warn("formio.js/utils findComponents is deprecated. Use searchComponents instead."),f(e,n)},findComponent:k,removeComponent:g,generateFormChange:function(e,n){let o;switch(e){case"add":o={op:"add",key:n.component.key,container:n.parent.key,path:n.path,index:n.index,component:n.component};break;case"edit":(o={op:"edit",key:n.originalComponent.key,patches:duplex.compare(n.originalComponent,n.component)}).patches.length||(o=null);break;case"remove":o={op:"remove",key:n.component.key}}return o},applyFormChanges:function(e,n){const t=[];return n.forEach(function(n){var s=!1;switch(n.op){case"add":var a=n.component;k(e.components,n.container,null,function(r){n.container||(r=e),k(e.components,n.key,null,function(n,o){a=n,g(e.components,o)}),s=!0,o(r,n.path).splice(n.index,0,a)});break;case"remove":k(e.components,n.key,null,function(n,r){s=!0,o(e.components,r).key!==n.key&&r.pop(),g(e.components,r)});break;case"edit":k(e.components,n.key,null,function(a,c){s=!0;try{const s=o(e.components,c),p=duplex.applyPatch(a,n.patches).newDocument;s.key!==p.key&&c.pop(),r(e.components,c,p)}catch(e){t.push(n)}})}s||t.push(n)}),{form:e,failed:t}},flattenComponents:function(e,n){const o={};return h(e,(e,n)=>{o[n]=e},n),o},hasCondition:function(e){return Boolean(e.customConditional||e.conditional&&e.conditional.when||e.conditional&&e.conditional.json)},parseFloatExt:A,formatAsCurrency:function(e){const n=A(e);if(p(n))return"";const o=u(n,2).toString().split(".");return o[0]=y(Array.from(o[0]).reverse(),3).reverse().map(e=>e.reverse().join("")).join(","),o[1]=d(o[1],2,"0"),o.join(".")},escapeRegExCharacters:function(e){return e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&")},getValue:function(e,n){const o=e=>{if(l(e)){if(t(e,n))return e[n];let r=null;return a(e,e=>{const n=o(e);if(!i(n))return r=n,!1}),r}return null};return o(e.data)},getStrings:function(e){const n=["label","title","legend","tooltip","description","placeholder","prefix","suffix","errorLabel","content","html"],o=[];return h(e.components,e=>{if(n.forEach(n=>{e.hasOwnProperty(n)&&e[n]&&o.push({key:e.key,type:e.type,property:n,string:e[n]})}),(!e.dataSrc||"values"===e.dataSrc)&&e.hasOwnProperty("values")&&Array.isArray(e.values)&&e.values.length&&e.values.forEach((n,r)=>{o.push({key:e.key,property:`value[${r}].label`,string:e.values[r].label})}),"day"===e.type&&(["day","month","year","Day","Month","Year","january","february","march","april","may","june","july","august","september","october","november","december"].forEach(n=>{o.push({key:e.key,property:"day",string:n})}),e.fields.day.placeholder&&o.push({key:e.key,property:"fields.day.placeholder",string:e.fields.day.placeholder}),e.fields.month.placeholder&&o.push({key:e.key,property:"fields.month.placeholder",string:e.fields.month.placeholder}),e.fields.year.placeholder&&o.push({key:e.key,property:"fields.year.placeholder",string:e.fields.year.placeholder})),"editgrid"===e.type){const n=e.addAnother||"Add Another";e.addAnother&&o.push({key:e.key,property:"addAnother",string:n})}"select"===e.type&&["loading...","Type to search"].forEach(n=>{o.push({key:e.key,property:"select",string:n})})},!0),o}}});
//# sourceMappingURL=../sourcemaps/utils/formUtils.js.map

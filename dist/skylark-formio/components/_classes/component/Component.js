/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["../../../vendors/vanilla-text-mask/conformToMask","../../../vendors/getify/npo","../../../vendors/tooltip-js/Tooltip","skylark-lodash","../../../vendors/ismobilejs/isMobile","../../../Formio","../../../utils/utils","../../../validator/Validator","../../../templates/Templates","../../../utils/utils","../../../Element","../componentModal/ComponentModal"],function(t,e,i,s,n,o,r,a,l,h,u,d){"use strict";const c="https://cdn.form.io/quill/1.3.7";return class p extends u{static schema(...t){return s.merge({input:!0,key:"",placeholder:"",prefix:"",customClass:"",suffix:"",multiple:!1,defaultValue:null,protected:!1,unique:!1,persistent:!0,hidden:!1,clearOnHide:!0,refreshOn:"",redrawOn:"",tableView:!1,modalEdit:!1,label:"",labelPosition:"top",description:"",errorLabel:"",tooltip:"",hideLabel:!1,tabindex:"",disabled:!1,autofocus:!1,dbIndex:!1,customDefaultValue:"",calculateValue:"",widget:null,attributes:{},validateOn:"change",validate:{required:!1,custom:"",customPrivate:!1,strictDateValidation:!1,multiple:!1,unique:!1},conditional:{show:null,when:null,eq:""},overlay:{style:"",left:"",top:"",width:"",height:""},allowCalculateOverride:!1,encrypted:!1,showCharCount:!1,showWordCount:!1,properties:{},allowMultipleMasks:!1},...t)}static tableView(t,e){}constructor(t,e,i){super(Object.assign({renderMode:"form",attachMode:"full"},e||{})),this._hasCondition=null,this.refs={},t&&this.options.components&&this.options.components[t.type]&&s.merge(t,this.options.components[t.type]),this.validator=a,this.path="",this.component=this.mergeSchema(t||{}),this.originalComponent=h.fastCloneDeep(this.component),this.attached=!1,this.rendered=!1,this._data=i||{},this.component.id=this.id,this.error="",this.tooltip="",this.row=this.options.row,this._disabled=!!h.boolValue(this.component.disabled)&&this.component.disabled,this.root=this.options.root,this.pristine=!0,this.parent=this.options.parent,this.options.name=this.options.name||"data",this.validators=["required","minLength","maxLength","minWords","maxWords","custom","pattern","json","mask"],this._path="",this._parentVisible=!this.options.hasOwnProperty("parentVisible")||this.options.parentVisible,this._visible=this._parentVisible&&this.conditionallyVisible(null,i),this._parentDisabled=!1;let n=null,o=[];const r=s.debounce((...t)=>(this.root&&(this.root.changing=!1),o=[],!t[1]&&n&&(t[1]=n),s.isEmpty(t[0])&&n&&(t[0]=n.flags),n=null,this.onChange(...t)),100);this.triggerChange=((...t)=>(t[1]&&(n=t[1]),this.root&&(this.root.changing=!0),t.length&&(o=t),r(...o))),this.triggerRedraw=s.debounce(this.redraw.bind(this),100),this.tooltips=[],this.invalid=!1,this.component&&(this.type=this.component.type,this.allowData&&this.key&&(this.options.name+=`[${this.key}]`,!this.visible&&this.component.clearOnHide||(this.hasValue()?this.dataValue=this.dataValue:this.dataValue=this.defaultValue)),this.info=this.elementInfo()),this.hook("component"),this.options.skipInit||this.init()}get data(){return this._data}set data(t){this._data=t}mergeSchema(t={}){return s.defaultsDeep(t,this.defaultSchema)}get ready(){return e.resolve(this)}get labelInfo(){const t={};return t.hidden=this.labelIsHidden(),t.className="",t.labelPosition=this.component.labelPosition,t.tooltipClass=`${this.iconClass("question-sign")} text-muted`,this.hasInput&&this.component.validate&&h.boolValue(this.component.validate.required)&&(t.className+=" field-required"),t.hidden&&(t.className+=" control-label--hidden"),this.info.attr.id&&(t.for=this.info.attr.id),t}init(){this.disabled=this.shouldDisabled}destroy(){super.destroy(),this.detach()}get shouldDisabled(){return this.options.readOnly||this.component.disabled||this.options.hasOwnProperty("disabled")&&this.options.disabled[this.key]}get isInputComponent(){return!this.component.hasOwnProperty("input")||this.component.input}get allowData(){return this.hasInput}get hasInput(){return this.isInputComponent||this.refs.input&&this.refs.input.length}get defaultSchema(){return p.schema()}get key(){return s.get(this.component,"key","")}set parentVisible(t){this._parentVisible!==t&&(this._parentVisible=t,this.clearOnHide(),this.redraw())}get parentVisible(){return this._parentVisible}set parentDisabled(t){this._parentDisabled!==t&&(this._parentDisabled=t,this.clearOnHide(),this.redraw())}get parentDisabled(){return this._parentDisabled}set visible(t){this._visible!==t&&(this._visible=t,this.clearOnHide(),this.redraw())}get visible(){return!(!this.builderMode&&!this.options.showHiddenFields)||(!this.options.hide||!this.options.hide[this.component.key])&&(!(!this.options.show||!this.options.show[this.component.key])||this._visible&&this._parentVisible)}get currentForm(){return this._currentForm}set currentForm(t){this._currentForm=t}get fullMode(){return"full"===this.options.attachMode}get builderMode(){return"builder"===this.options.attachMode}get calculatedPath(){if(this._path)return this._path;if(this._path=this.key,!this.root)return this._path;let t=this.parent;for(;t&&t.id!==this.root.id;)(["datagrid","container","editgrid"].includes(t.type)||t.tree)&&(this._path=`${t.key}.${this._path}`),t=t.parent;return this._path}get labelPosition(){return this.component.labelPosition}get labelWidth(){return this.component.labelWidth||30}get labelMargin(){return this.component.labelMargin||3}get isAdvancedLabel(){return["left-left","left-right","right-left","right-right"].includes(this.labelPosition)}get labelPositions(){return this.labelPosition.split("-")}rightDirection(t){return"right"===t}getLabelInfo(){const t=this.rightDirection(this.labelPositions[0]);return{isRightPosition:t,isRightAlign:this.rightDirection(this.labelPositions[1]),labelStyles:`\n      flex: ${this.labelWidth};\n      ${t?"margin-left":"margin-right"}:${this.labelMargin}%;\n    `,contentStyles:`\n      flex: ${100-this.labelWidth-this.labelMargin};\n    `}}getModifiedSchema(t,e,i){const n={};return e?(s.each(t,(t,o)=>{if(!s.isArray(t)&&s.isObject(t)&&e.hasOwnProperty(o)){const i=this.getModifiedSchema(t,e[o],!0);s.isEmpty(i)||(n[o]=i)}else s.isArray(t)?0!==t.length&&(n[o]=t):(!i&&"type"===o||!i&&"key"===o||!i&&"label"===o||!i&&"input"===o||!i&&"tableView"===o||""!==t&&!e.hasOwnProperty(o)||""!==t&&t!==e[o])&&(n[o]=t)}),n):t}get schema(){return h.fastCloneDeep(this.getModifiedSchema(s.omit(this.component,"id"),this.defaultSchema))}t(t,e){if(!t)return"";return(e=e||{}).data=this.rootValue,e.row=this.data,e.component=this.component,e.nsSeparator="::",e.keySeparator=".|.",e.pluralSeparator="._.",e.contextSeparator="._.",this.i18next.t(t,e)||t}labelIsHidden(){return!this.component.label||!this.inDataGrid&&this.component.hideLabel||this.inDataGrid&&!this.component.dataGridLabel||this.options.inputsOnly}get transform(){return l.current.hasOwnProperty("transform")?l.current.transform.bind(l.current):(t,e)=>e}getTemplate(t,e){e=Array.isArray(e)?e:[e],t=Array.isArray(t)?t:[t],e.includes("form")||e.push("form");let i=null;if(this.options.templates&&(i=this.checkTemplate(this.options.templates,t,e)))return i;const s=this.options.template?l.templates[this.options.template]:l.current;if(i=this.checkTemplate(s,t,e))return i;const n=t[t.length-1],o=l.defaultTemplates[n];if(!o)return`Unknown template: ${n}`;const r=this.checkTemplateMode(o,e);return r||o.form}checkTemplate(t,e,i){for(const s of e){const e=t[s];if(e){const t=this.checkTemplateMode(e,i);if(t)return t}}return null}checkTemplateMode(t,e){for(const i of e){const e=t[i];if(e)return e}return null}renderTemplate(t,e={},i){const s=i||this.options.renderMode||"form";e.component=this.component,e.self=this,e.options=this.options,e.readOnly=this.options.readOnly,e.iconClass=this.iconClass.bind(this),e.t=this.t.bind(this),e.transform=this.transform,e.id=e.id||this.id,e.key=e.key||this.key,e.value=e.value||this.dataValue,e.disabled=this.disabled,e.builder=this.builderMode,e.render=((...t)=>(console.warn("Form.io 'render' template function is deprecated.\n      If you need to render template (template A) inside of another template (template B),\n      pass pre-compiled template A (use this.renderTemplate('template_A_name') as template context variable for template B"),this.renderTemplate(...t))),e.label=this.labelInfo,e.tooltip=this.interpolate(this.component.tooltip||"").replace(/(?:\r\n|\r|\n)/g,"<br />");const n=[`${t}-${this.component.type}-${this.key}`,`${t}-${this.component.type}`,`${t}-${this.key}`,`${t}`];return this.hook(`render${t.charAt(0).toUpperCase()+t.substring(1,t.length)}`,this.interpolate(this.getTemplate(n,s),e),e,s)}sanitize(t){return r.sanitize(t,this.options)}renderString(t,e){return t?this.interpolate(t,e):""}performInputMapping(t){return t}getBrowserLanguage(){const t=window.navigator,e=["language","browserLanguage","systemLanguage","userLanguage"];let i;if(Array.isArray(t.languages))for(let e=0;e<t.languages.length;e++)if((i=t.languages[e])&&i.length)return i.split(";")[0];for(let s=0;s<e.length;s++)if((i=t[e[s]])&&i.length)return i.split(";")[0];return null}beforePage(){return e.resolve(!0)}beforeNext(){return this.beforePage(!0)}beforeSubmit(){return e.resolve(!0)}get submissionTimezone(){return this.options.submissionTimezone=this.options.submissionTimezone||s.get(this.root,"options.submissionTimezone"),this.options.submissionTimezone}loadRefs(t,e){for(const i in e)"single"===e[i]?this.refs[i]=t.querySelector(`[ref="${i}"]`):this.refs[i]=t.querySelectorAll(`[ref="${i}"]`)}setOpenModalElement(){const t=`\n      <label class="control-label">${this.component.label}</label><br>\n      <button lang='en' class='btn btn-light btn-md open-modal-button' ref='openModal'>Click to set value</button>\n    `;this.componentModal.setOpenModalElement(t)}getModalPreviewTemplate(){return`\n      <label class="control-label">${this.component.label}</label><br>\n      <button lang='en' class='btn btn-light btn-md open-modal-button' ref='openModal'>${this.getValueAsString(this.dataValue)}</button>`}build(t){return t=t||this.element,this.empty(t),this.setContent(t,this.render()),this.attach(t)}render(t=`Unknown component: ${this.component.type}`,e=!1){const i=this.visible;return this.rendered=!0,!this.builderMode&&this.component.modalEdit?d.render(this,{visible:i,id:this.id,classes:this.className,styles:this.customStyle,children:t},e):this.renderTemplate("component",{visible:i,id:this.id,classes:this.className,styles:this.customStyle,children:t},e)}attach(t){!this.builderMode&&this.component.modalEdit&&(this.componentModal=new d(this,t),this.setOpenModalElement()),this.attached=!0,this.element=t,t.component=this,this.element.id&&(this.id=this.element.id),this.loadRefs(t,{messageContainer:"single",tooltip:"multiple"}),this.refs.tooltip.forEach((t,e)=>{const s=this.interpolate(t.getAttribute("data-title")||this.t(this.component.tooltip)).replace(/(?:\r\n|\r|\n)/g,"<br />");this.tooltips[e]=new i(t,{trigger:"hover click focus",placement:"right",html:!0,title:s,template:'\n          <div class="tooltip" style="opacity: 1;" role="tooltip">\n            <div class="tooltip-arrow"></div>\n            <div class="tooltip-inner"></div>\n          </div>'})}),this.attachLogic(),this.autofocus(),this.hook("attachComponent",t,this);const s=this.component.type;return s&&this.hook(`attach${s.charAt(0).toUpperCase()+s.substring(1,s.length)}`,t,this),e.resolve()}addShortcut(t,e){t&&this.root&&this.root!==this&&(e||(e=this.component.shortcut),this.root.addShortcut(t,e))}removeShortcut(t,e){t&&this.root!==this&&(e||(e=this.component.shortcut),this.root.removeShortcut(t,e))}detach(){this.refs={},this.removeEventListeners(),this.detachLogic(),this.tooltip&&this.tooltip.dispose()}checkRefresh(t,e){const i=s.get(e,"instance.calculatedPath",!1);i&&this.calculatedPath===i||("data"===t?this.refresh(this.data):i&&i===t&&e&&e.instance&&this.inContext(e.instance)&&this.refresh(e.value))}checkRefreshOn(t){const e=this.component.refreshOn||this.component.redrawOn;e&&(Array.isArray(e)?e.forEach(e=>{this.checkRefresh(e,t)}):this.checkRefresh(e,t))}refresh(t){this.hasOwnProperty("refreshOnValue")?this.refreshOnChanged=!s.isEqual(t,this.refreshOnValue):this.refreshOnChanged=!0,this.refreshOnValue=h.fastCloneDeep(t),this.refreshOnChanged&&(this.component.clearOnRefresh&&this.setValue(null),this.triggerRedraw())}inContext(t){if(t.data===this.data)return!0;let e=this.parent;for(;e;){if(e.data===t.data)return!0;e=e.parent}return!1}get viewOnly(){return this.options.readOnly&&this.options.viewAsHtml}createViewOnlyElement(){return this.element=this.ce("dl",{id:this.id}),this.element&&(this.element.component=this),this.element}get defaultViewOnlyValue(){return"-"}getWidgetValueAsString(t){const e=!this.refs.input||!this.refs.input[0]||!this.refs.input[0].widget;if(!t||e)return t;if(Array.isArray(t)){const e=[];return t.forEach((t,i)=>{const s=this.refs.input[i]&&this.refs.input[i].widge;s&&e.push(s.getValueAsString(t))}),e}return this.refs.input[0].widget.getValueAsString(t)}getValueAsString(t){return t?(t=this.getWidgetValueAsString(t),Array.isArray(t)?t.join(", "):s.isPlainObject(t)?JSON.stringify(t):null===t||void 0===t?"":t.toString()):""}getView(t){return this.component.protected?"--- PROTECTED ---":this.getValueAsString(t)}updateItems(...t){this.restoreValue(),this.onChange(...t)}itemValue(t,e=!1){if(s.isObject(t)){if(this.valueProperty)return s.get(t,this.valueProperty);if(e)return t.value}return t}itemValueForHTMLMode(t){if(Array.isArray(t)){return t.map(t=>Array.isArray(t)?this.itemValueForHTMLMode(t):this.itemValue(t)).join(", ")}return this.itemValue(t)}createModal(t,e){const i=this.ce("div",e||{});this.setContent(i,this.renderTemplate("dialog")),i.refs={},this.loadRefs.call(i,i,{dialogOverlay:"single",dialogContents:"single",dialogClose:"single"}),i.refs.dialogContents.appendChild(t),document.body.appendChild(i),document.body.classList.add("modal-open"),i.close=(()=>{document.body.classList.remove("modal-open"),i.dispatchEvent(new CustomEvent("close"))}),this.addEventListener(i,"close",()=>this.removeChildFrom(i,document.body));const s=t=>{t.preventDefault(),i.close()};return this.addEventListener(i.refs.dialogOverlay,"click",s),this.addEventListener(i.refs.dialogClose,"click",s),i}get className(){let t=this.hasInput?"form-group has-feedback ":"";return t+=`formio-component formio-component-${this.component.type} `,this.key&&(t+=`formio-component-${this.key} `),this.component.multiple&&(t+="formio-component-multiple "),this.component.customClass&&(t+=this.component.customClass),this.hasInput&&this.component.validate&&h.boolValue(this.component.validate.required)&&(t+=" required"),this.labelIsHidden()&&(t+=" formio-component-label-hidden"),this.visible||(t+=" formio-hidden"),t}get customStyle(){let t="";return s.each(this.component.style,(e,i)=>{""!==e&&(t+=`${i}:${e};`)}),t}get isMobile(){return n()}getElement(){return this.element}evalContext(t){return super.evalContext(Object.assign({component:this.component,row:this.data,rowIndex:this.rowIndex,data:this.rootValue,iconClass:this.iconClass.bind(this),submission:this.root?this.root._submission:{},form:this.root?this.root._form:{}},t))}setPristine(t){this.pristine=t}removeValue(t){this.splice(t),this.redraw(),this.restoreValue(),this.triggerRootChange()}iconClass(t,e){const i=this.options.iconset||l.current.defaultIconset||"fa";return l.current.hasOwnProperty("iconClass")?l.current.iconClass(i,t,e):"fa"===this.options.iconset?l.defaultTemplates.iconClass(i,t,e):t}get name(){return this.t(this.component.label||this.component.placeholder||this.key)}get errorLabel(){return this.t(this.component.errorLabel||this.component.label||this.component.placeholder||this.key)}errorMessage(t){return this.component.errors&&this.component.errors[t]?this.component.errors[t]:t}setContent(t,e){return t instanceof HTMLElement&&(t.innerHTML=this.sanitize(e),!0)}redraw(){if(!this.element||!this.element.parentNode)return e.resolve();this.clear();const t=this.element.parentNode,i=Array.prototype.indexOf.call(t.children,this.element);return this.element.outerHTML=this.sanitize(this.render()),this.element=t.children[i],this.attach(this.element)}rebuild(){return this.destroy(),this.init(),this.redraw()}removeEventListeners(){super.removeEventListeners(),this.tooltips.forEach(t=>t.dispose()),this.tooltips=[],this.refs.input=[]}hasClass(t,e){if(t)return super.hasClass(t,this.transform("class",e))}addClass(t,e){if(t)return super.addClass(t,this.transform("class",e))}removeClass(t,e){if(t)return super.removeClass(t,this.transform("class",e))}hasCondition(){return null!==this._hasCondition?this._hasCondition:(this._hasCondition=r.hasCondition(this.component),this._hasCondition)}conditionallyVisible(t,e){return t=t||this.rootValue,e=e||this.data,this.builderMode||!this.hasCondition()?!this.component.hidden:(t=t||(this.root?this.root.data:{}),this.checkCondition(e,t))}checkCondition(t,e){return r.checkCondition(this.component,t||this.data,e||this.rootValue,this.root?this.root._form:{},this)}checkComponentConditions(t,e,i){t=t||this.rootValue,e=e||{},i=i||this.data,!this.builderMode&&this.fieldLogic(t,i)&&this.redraw();const s=this.conditionallyVisible(t,i);return this.visible!==s&&(this.visible=s),s}checkConditions(t,e,i){return t=t||this.rootValue,e=e||{},i=i||this.data,this.checkComponentConditions(t,e,i)}get logic(){return this.component.logic||[]}fieldLogic(t,e){t=t||this.rootValue,e=e||this.data;const i=this.logic;if(0===i.length)return;const n=h.fastCloneDeep(this.originalComponent);let o=i.reduce((i,s)=>{const o=r.checkTrigger(n,s.trigger,e,t,this.root?this.root._form:{},this);return!!o&&this.applyActions(n,s.actions,o,e,t)||i},!1);return s.isEqual(this.component,n)||(this.component=n,this.disabled=this.shouldDisabled,o=!0),o}isIE(){const t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){const e=t.indexOf("rv:");return parseInt(t.substring(e+3,t.indexOf(".",e)),10)}const i=t.indexOf("Edge/");return i>0&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)}applyActions(t,e,i,n,o){return o=o||this.rootValue,n=n||this.data,e.reduce((e,a)=>{switch(a.type){case"property":{r.setActionProperty(t,a,i,n,o,this);const l=a.property.value;s.isEqual(s.get(this.component,l),s.get(t,l))||(e=!0);break}case"value":{const r=this.getValue(),l=this.evaluate(a.value,{value:s.clone(r),data:o,row:n,component:t,result:i},"value");s.isEqual(r,l)||(this.setValue(l),this.viewOnly&&(this.dataValue=l),e=!0);break}case"mergeComponentSchema":{const r=this.evaluate(a.schemaDefinition,{value:s.clone(this.getValue()),data:o,row:n,component:t,result:i},"schema");s.assign(t,r),s.isEqual(this.component,t)||(e=!0);break}}return e},!1)}addInputError(t,e,i){this.addMessages(t),this.setErrorClasses(i,e,!!t)}removeInputError(t){this.setErrorClasses(t,!0,!1)}addMessages(t){t&&("string"==typeof t&&(t={messages:t,level:"error"}),Array.isArray(t)||(t=[t]),this.refs.messageContainer&&this.setContent(this.refs.messageContainer,t.map(t=>this.renderTemplate("message",t)).join("")))}setErrorClasses(t,e,i,s){this.clearErrorClasses(),t.forEach(t=>this.removeClass(this.performInputMapping(t),"is-invalid")),i&&(t.forEach(t=>this.addClass(this.performInputMapping(t),"is-invalid")),e&&this.options.highlightErrors?this.addClass(this.element,this.options.componentErrorClass):this.addClass(this.element,"has-error")),s&&this.addClass(this.element,"has-message")}clearOnHide(){this.rootPristine||!1===this.component.clearOnHide||this.options.readOnly||this.options.showHiddenFields||(this.visible?this.hasValue()||this.setValue(this.defaultValue,{noUpdateEvent:!0}):this.deleteValue())}triggerRootChange(...t){this.options.onChange?this.options.onChange(...t):this.root&&this.root.triggerChange(...t)}onChange(t,e){(t=t||{}).modified&&(this.pristine=!1,this.addClass(this.getElement(),"formio-modified")),"blur"!==this.component.validateOn||this.errors.length||(t.noValidate=!0),this.component.onChange&&this.evaluate(this.component.onChange,{flags:t});const i={instance:this,component:this.component,value:this.dataValue,flags:t};this.emit("componentChange",i);let s=!1;return t.modified&&(s=!0,delete t.modified),e||this.triggerRootChange(t,i,s),i}get wysiwygDefault(){return{quill:{theme:"snow",placeholder:this.t(this.component.placeholder),modules:{toolbar:[[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],["bold","italic","underline","strike",{script:"sub"},{script:"super"},"clean"],[{color:[]},{background:[]}],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"},{align:[]}],["blockquote","code-block"],["link","image","video","formula","source"]]}},ace:{theme:"ace/theme/xcode",maxLines:12,minLines:12,tabSize:2,mode:"javascript",placeholder:this.t(this.component.placeholder)},ckeditor:{image:{toolbar:["imageTextAlternative","|","imageStyle:full","imageStyle:alignLeft","imageStyle:alignCenter","imageStyle:alignRight"],styles:["full","alignLeft","alignCenter","alignRight"]}},tiny:{theme:"silver"},default:{}}}addCKE(t,i,n){return(i=s.isEmpty(i)?{}:i).base64Upload=!0,i.mediaEmbed={previewsInData:!0},i=s.merge(this.wysiwygDefault.ckeditor,s.get(this.options,"editors.ckeditor.settings",{}),i),o.requireLibrary("ckeditor","ClassicEditor",s.get(this.options,"editors.ckeditor.src","https://cdn.form.io/ckeditor/16.0.0/ckeditor.js"),!0).then(()=>t.parentNode?ClassicEditor.create(t,i).then(t=>(t.model.document.on("change",()=>n(t.data.get())),t)):e.reject())}addQuill(t,i,n){return i=s.isEmpty(i)?this.wysiwygDefault.quill:i,i=s.merge(this.wysiwygDefault.quill,s.get(this.options,"editors.quill.settings",{}),i),o.requireLibrary(`quill-css-${i.theme}`,"Quill",[{type:"styles",src:`${c}/quill.${i.theme}.css`}],!0),o.requireLibrary("quill","Quill",s.get(this.options,"editors.quill.src",`${c}/quill.min.js`),!0).then(()=>{if(!t.parentNode)return e.reject();this.quill=new Quill(t,i);const s=document.createElement("textarea");s.setAttribute("class","quill-source-code"),this.quill.addContainer("ql-custom").appendChild(s);const o=t.parentNode.querySelector(".ql-source");o&&this.addEventListener(o,"click",t=>{t.preventDefault(),"inherit"===s.style.display&&this.quill.setContents(this.quill.clipboard.convert(s.value)),s.style.display="none"===s.style.display?"inherit":"none"}),this.addEventListener(t,"click",()=>this.quill.focus());const r=document.querySelectorAll(".ql-formats > button");for(let t=0;t<r.length;t++)r[t].setAttribute("tabindex","-1");return this.quill.on("text-change",()=>{s.value=this.quill.root.innerHTML,n(s)}),this.quill})}addAce(t,e,i){return e=s.merge(this.wysiwygDefault.ace,s.get(this.options,"editors.ace.settings",{}),e||{}),o.requireLibrary("ace","ace",s.get(this.options,"editors.ace.src","https://cdn.form.io/ace/1.4.8/ace.js"),!0).then(s=>((s=s.edit(t)).removeAllListeners("change"),s.setOptions(e),s.getSession().setMode(`ace/mode/${e.mode}`),s.on("change",()=>i(s.getValue())),s))}addTiny(t,e,i){return o.requireLibrary("tinymce","tinymce","https://cdn.tiny.cloud/1/no-api-key/tinymce/5/tinymce.min.js".replace("no-api-key",e.tinyApiKey),!0).then(s=>s.init({...e,target:t,init_instance_callback:t=>{t.on("Change",()=>i(t.getContent()))}}))}get tree(){return this.component.tree||!1}get emptyValue(){return null}hasValue(t){return s.has(t||this.data,this.key)}get rootValue(){return this.root?this.root.data:this.data}get rootPristine(){return s.get(this,"root.pristine",!1)}get dataValue(){if(!this.key||!this.visible&&this.component.clearOnHide&&!this.rootPristine)return this.emptyValue;if(!this.hasValue()){const t=this.component.multiple?[]:this.emptyValue;return this.rootPristine||(this.dataValue=t),t}return s.get(this._data,this.key)}set dataValue(t){return this.allowData&&this.key&&(this.visible||!this.component.clearOnHide||this.rootPristine)?(null!==t&&void 0!==t&&(t=this.hook("setDataValue",t,this.key,this._data)),null===t||void 0===t?(this.unset(),t):(s.set(this._data,this.key,t),t)):t}splice(t){if(this.hasValue()){const e=this.dataValue||[];s.isArray(e)&&e.hasOwnProperty(t)&&(e.splice(t,1),this.dataValue=e,this.triggerChange())}}unset(){s.unset(this._data,this.key)}deleteValue(){this.setValue(null,{noUpdateEvent:!0,noDefault:!0}),this.unset()}get defaultValue(){let e=this.emptyValue;return this.component.defaultValue&&(e=this.component.defaultValue),this.component.customDefaultValue&&!this.options.preview&&(e=this.evaluate(this.component.customDefaultValue,{value:""},"value")),this.defaultMask&&("string"==typeof e?(e=t(e,this.defaultMask).conformedValue,r.matchInputMask(e,this.defaultMask)||(e="")):e=""),s.cloneDeep(e)}getValue(){if(!this.hasInput||this.viewOnly||!this.refs.input||!this.refs.input.length)return this.dataValue;const t=[];for(const e in this.refs.input)if(this.refs.input.hasOwnProperty(e)){if(!this.component.multiple)return this.getValueAt(e);t.push(this.getValueAt(e))}return 0!==t.length||this.component.multiple?t:""}getValueAt(t){const e=this.performInputMapping(this.refs.input[t]);return e?e.value:void 0}setValue(t,e={}){const i=this.updateValue(t,e);if(this.componentModal&&e&&e.fromSubmission&&this.componentModal.setValue(t),t=this.dataValue,!this.hasInput)return i;const s=Array.isArray(t);s&&Array.isArray(this.defaultValue)&&this.refs.hasOwnProperty("input")&&this.refs.input&&this.refs.input.length!==t.length&&this.redraw();for(const i in this.refs.input)this.refs.input.hasOwnProperty(i)&&this.setValueAt(i,s?t[i]:t,e);return i}setValueAt(t,e,i={}){i.noDefault||null!==e&&void 0!==e||this.component.multiple||(e=this.defaultValue);const s=this.performInputMapping(this.refs.input[t]);s.mask?s.mask.textMaskInputElement.update(e):s.widget&&s.widget.setValue?s.widget.setValue(e):s.value=e}get hasSetValue(){return this.hasValue()&&!this.isEmpty(this.dataValue)}restoreValue(){if(this.hasSetValue)this.setValue(this.dataValue,{noUpdateEvent:!0});else if(this.defaultValue){const t=this.component.multiple&&!this.dataValue.length?[]:this.defaultValue;this.setValue(t,{noUpdateEvent:!0})}}normalizeValue(t){return this.component.multiple&&!Array.isArray(t)&&(t=t?[t]:[]),t}updateComponentValue(t,e={}){let i=e.resetValue||void 0!==t&&null!==t?t:this.getValue();const s=void 0!==(i=this.normalizeValue(i,e))&&this.hasChanged(i,this.dataValue);return s&&(this.dataValue=i,this.updateOnChange(e,s)),s}updateValue(...t){return this.updateComponentValue(...t)}getIcon(t,e,i,s="icon"){return this.renderTemplate("icon",{className:this.iconClass(t),ref:s,styles:i,content:e})}resetValue(){this.setValue(this.emptyValue,{noUpdateEvent:!0,noValidate:!0,resetValue:!0}),this.unset()}hasChanged(t,e){return(void 0!==t&&null!==t||void 0!==e&&null!==e&&!this.isEmpty(e))&&(void 0!==t&&null!==t&&!this.hasValue()||!s.isEqual(t,e))}updateOnChange(t={},e=!1){return!(t.noUpdateEvent||!e)&&(this.triggerChange(t),!0)}convertNumberOrBoolToString(t){return"number"==typeof t||"boolean"==typeof t?t.toString():t}calculateComponentValue(t,e,i){if(!this.component.calculateValue||(!this.visible||this.component.hidden)&&this.component.clearOnHide&&!this.rootPristine)return!1;const n=this.component.allowCalculateOverride;let o=!1;const r=this.dataValue;if(void 0===this.calculatedValue&&(o=!0,this.calculatedValue=null),n&&this.calculatedValue&&!s.isEqual(r,this.convertNumberOrBoolToString(this.calculatedValue)))return!1;const a=this.evaluate(this.component.calculateValue,{value:r,data:t,row:i||this.data},"value");if(n&&o&&!this.isEmpty(r)&&!s.isEqual(r,this.convertNumberOrBoolToString(a)))return this.calculatedValue=a,!0;const l=this.setValue(a,e);return this.calculatedValue=this.dataValue,l}calculateValue(t,e,i){return t=t||this.rootValue,e=e||{},i=i||this.data,this.calculateComponentValue(t,e,i)}get label(){return this.component.label}set label(t){this.component.label=t,this.labelElement&&(this.labelElement.innerText=t)}getRoot(){return this.root}invalidMessage(t,e,i,n){return i||this.checkCondition(n,t)?this.invalid?this.invalid:!this.hasInput||!e&&this.pristine?"":s.map(a.checkComponent(this,t),"message").join("\n\n"):""}isValid(t,e){return!this.invalidMessage(t,e)}setComponentValidity(t,e){const i=!!t.filter(t=>"error"===t.level).length;return!t.length||!e&&this.pristine?this.setCustomValidity(""):this.setCustomValidity(t,e),!i}checkComponentValidity(t,i,s,n=!1){if(t=t||this.rootValue,s=s||this.data,this.shouldSkipValidation(t,i,s))return this.setCustomValidity(""),!n||e.resolve(!0);const o=a.checkComponent(this,t,s,!0,n);return n?o.then(t=>this.setComponentValidity(t,i)):this.setComponentValidity(o,i)}checkValidity(t,e,i){return t=t||this.rootValue,i=i||this.data,this.checkComponentValidity(t,e,i)}checkAsyncValidity(t,i,s){return e.resolve(this.checkComponentValidity(t,i,s,!0))}checkData(t,e,i){if(t=t||this.rootValue,e=e||{},i=i||this.data,this.checkRefreshOn(e.changed),e.noCheck)return!0;if(this.calculateComponentValue(t,e,i),this.checkComponentConditions(t,e,i),e.noValidate)return!0;let s=!this.builderMode&&!this.options.preview&&!this.isEmpty(this.defaultValue)&&this.isEqual(this.defaultValue,this.dataValue);return(this.options.alwaysDirty||e.dirty)&&(s=!0),e.fromSubmission&&this.hasValue(t)&&(s=!0),this.checkComponentValidity(t,s,i)}get validationValue(){return this.dataValue}isEmpty(t=this.dataValue){const e=!(!s.isArray(t)||1!==t.length)&&s.isEqual(t[0],this.emptyValue);return null==t||0===t.length||s.isEqual(t,this.emptyValue)||e}isEqual(t,e=this.dataValue){return this.isEmpty(t)&&this.isEmpty(e)||s.isEqual(t,e)}validateMultiple(){return!0}get errors(){return this.error?[this.error]:[]}clearErrorClasses(){this.removeClass(this.element,this.options.componentErrorClass),this.removeClass(this.element,"alert alert-danger"),this.removeClass(this.element,"has-error"),this.removeClass(this.element,"has-message")}setCustomValidity(t,e,i){"string"==typeof t&&t&&(t={level:"error",message:t}),Array.isArray(t)||(t=t?[t]:[]);const s=!!t.filter(t=>"error"===t.level).length;t.length?(this.refs.messageContainer&&this.empty(this.refs.messageContainer),this.error={component:this.component,message:t[0].message,messages:t,external:!!i},this.emit("componentError",this.error),this.addMessages(t,e,this.refs.input),this.refs.input&&this.setErrorClasses(this.refs.input,e,s,!!t.length)):this.error&&this.error.external===!!i&&(this.refs.messageContainer&&this.empty(this.refs.messageContainer),this.error=null,this.refs.input&&this.setErrorClasses(this.refs.input,e,s,!!t.length),this.clearErrorClasses())}isValueHidden(){return!(!this.root||!this.root.hasOwnProperty("editing"))&&(!(!this.root||!this.root.editing)&&(this.component.protected||!this.component.persistent||"client-only"===this.component.persistent))}shouldSkipValidation(t,e,i){return[()=>this.shouldDisabled,()=>this.isValueHidden(),()=>!this.visible,()=>!this.checkCondition(i,t)].some(t=>t())}whenReady(){return console.warn("The whenReady() method has been deprecated. Please use the dataReady property instead."),this.dataReady}get dataReady(){return e.resolve()}asString(t){return t=t||this.getValue(),(Array.isArray(t)?t:[t]).map(s.toString).join(", ")}get disabled(){return this._disabled||this.parentDisabled}set disabled(t){this._disabled=t}setDisabled(t,e){t&&(t.disabled=e,e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled"))}setLoading(t,e){t&&t.loading!==e&&(t.loading=e,!t.loader&&e&&(t.loader=this.ce("i",{class:`${this.iconClass("refresh",!0)} button-icon-right`})),t.loader&&(e?this.appendTo(t.loader,t):this.removeChildFrom(t.loader,t)))}selectOptions(t,e,i,n){s.each(i,e=>{const i={value:e.value};void 0!==n&&e.value===n&&(i.selected="selected");const s=this.ce("option",i);s.appendChild(this.text(e.label)),t.appendChild(s)})}setSelectValue(t,e){const i=t.querySelectorAll("option");s.each(i,t=>{t.value===e?t.setAttribute("selected","selected"):t.removeAttribute("selected")}),t.onchange&&t.onchange(),t.onselect&&t.onselect()}clear(){this.detach(),this.empty(this.getElement())}append(t){this.appendTo(t,this.element)}prepend(t){this.prependTo(t,this.element)}removeChild(t){this.removeChildFrom(t,this.element)}detachLogic(){this.logic.forEach(t=>{if("event"===t.trigger.type){const e=this.interpolate(t.trigger.event);this.off(e)}})}attachLogic(){this.builderMode||this.logic.forEach(t=>{if("event"===t.trigger.type){const e=this.interpolate(t.trigger.event);this.on(e,(...e)=>{const i=h.fastCloneDeep(this.originalComponent);this.applyActions(i,t.actions,e)&&(s.isEqual(this.component,i)||(this.component=i),this.redraw())},!0)}})}elementInfo(){const t={name:this.options.name,type:this.component.inputType||"text",class:"form-control",lang:this.options.language};return this.component.placeholder&&(t.placeholder=this.t(this.component.placeholder)),this.component.tabindex&&(t.tabindex=this.component.tabindex),this.disabled&&(t.disabled="disabled"),s.defaults(t,this.component.attributes),{type:"input",component:this.component,changeEvent:"change",attr:t}}autofocus(){this.component.autofocus&&!this.builderMode&&this.on("render",()=>this.focus(),!0)}focus(){this.refs.input&&this.refs.input[0]&&this.refs.input[0].focus()}}});
//# sourceMappingURL=../../../sourcemaps/components/_classes/component/Component.js.map

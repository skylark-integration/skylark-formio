/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["../_classes/component/Component","../../Formio","skylark-lodash","../../vendors/getify/npo"],function(e,t,r,a){"use strict";var i=r.get;return class r extends e{static schema(...t){return e.schema({type:"recaptcha",key:"recaptcha",label:"reCAPTCHA"},...t)}static get builderInfo(){return{title:"reCAPTCHA",group:"premium",icon:"refresh",documentation:"http://help.form.io/userguide/#recaptcha",weight:40,schema:r.schema()}}render(){return this.builderMode?super.render("reCAPTCHA"):super.render("",!0)}createInput(){if(this.builderMode)this.append(this.text(this.name));else{const e=i(this.root.form,"settings.recaptcha.siteKey");if(e){const r=`https://www.google.com/recaptcha/api.js?render=${e}`;this.recaptchaApiReady=t.requireLibrary("googleRecaptcha","grecaptcha",r,!0)}else console.warn("There is no Site Key specified in settings in form JSON")}}createLabel(){}verify(e){const r=i(this.root.form,"settings.recaptcha.siteKey");if(r){if(!this.recaptchaApiReady){const e=`https://www.google.com/recaptcha/api.js?render=${i(this.root.form,"settings.recaptcha.siteKey")}`;this.recaptchaApiReady=t.requireLibrary("googleRecaptcha","grecaptcha",e,!0)}this.recaptchaApiReady&&(this.recaptchaVerifiedPromise=new a((t,a)=>{this.recaptchaApiReady.then(()=>{grecaptcha.ready(()=>{grecaptcha.execute(r,{action:e}).then(e=>this.sendVerificationRequest(e)).then(e=>(this.setValue(e),t(e)))})}).catch(()=>a())}))}else console.warn("There is no Site Key specified in settings in form JSON")}beforeSubmit(){return this.recaptchaVerifiedPromise?this.recaptchaVerifiedPromise.then(()=>super.beforeSubmit()):super.beforeSubmit()}sendVerificationRequest(e){return t.makeStaticRequest(`${t.projectUrl}/recaptcha?recaptchaToken=${e}`)}setValue(e){const t=this.hasChanged(e,this.dataValue);return this.dataValue=e,t}getValue(){return this.dataValue}}});
//# sourceMappingURL=../../sourcemaps/components/recaptcha/ReCaptcha.js.map

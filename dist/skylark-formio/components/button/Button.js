/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["skylark-lodash","../_classes/field/Field","../_classes/input/Input","../../utils/utils"],function(t,s,e,o){"use strict";return class i extends s{static schema(...t){return e.schema({type:"button",label:"Submit",key:"submit",size:"md",leftIcon:"",rightIcon:"",block:!1,action:"submit",persistent:!1,disableOnInvalid:!1,theme:"primary",dataGridLabel:!0},...t)}static get builderInfo(){return{title:"Button",group:"basic",icon:"stop",documentation:"http://help.form.io/userguide/#button",weight:110,schema:i.schema()}}get defaultSchema(){return i.schema()}get inputInfo(){const t=super.elementInfo();return t.type="button",t.attr.type=["submit","saveState"].includes(this.component.action)?"submit":"button",this.component.theme=this.component.theme||"default",t.attr.class=`btn btn-${this.component.theme}`,this.component.size&&(t.attr.class+=` btn-${this.component.size}`),this.component.block&&(t.attr.class+=" btn-block"),this.component.customClass&&(t.attr.class+=` ${this.component.customClass}`),t.content=this.t(this.component.label),t}get labelInfo(){return{hidden:!0}}set loading(t){this.setLoading(this.refs.button,t)}createLabel(){}createInput(t){return this.refs.button=super.createInput(t),this.refs.button}get emptyValue(){return!1}getValue(){return this.dataValue}get clicked(){return this.dataValue}get defaultValue(){return!1}get className(){let t=super.className;return t+=" form-group"}render(){return(this.viewOnly||this.options.hideButtons)&&(this._visible=!1),super.render(this.renderTemplate("button",{component:this.component,input:this.inputInfo}))}attachButton(){this.addShortcut(this.refs.button);let t=null,s=null;if("submit"===this.component.action&&(this.on("submitButton",()=>{this.disabled=!0},!0),this.on("submitDone",()=>{this.loading=!1,this.disabled=!1,this.addClass(this.refs.button,"btn-success submit-success"),this.removeClass(this.refs.button,"btn-danger submit-fail"),this.addClass(this.refs.buttonMessageContainer,"has-success"),this.removeClass(this.refs.buttonMessageContainer,"has-error"),this.setContent(this.refs.buttonMessage,this.t("complete"))},!0),this.on("submitError",()=>{this.loading=!1,this.disabled=!1,this.removeClass(this.refs.button,"btn-success submit-success"),this.addClass(this.refs.button,"btn-danger submit-fail"),this.removeClass(this.refs.buttonMessageContainer,"has-success"),this.addClass(this.refs.buttonMessageContainer,"has-error"),this.setContent(this.refs.buttonMessage,this.t(this.errorMessage("error")))},!0),t=((t,s)=>{this.removeClass(this.refs.button,"btn-success submit-success"),this.removeClass(this.refs.button,"btn-danger submit-fail"),s&&this.hasError&&(this.hasError=!1,this.setContent(this.refs.buttonMessage,""),this.removeClass(this.refs.buttonMessageContainer,"has-success"),this.removeClass(this.refs.buttonMessageContainer,"has-error"))}),s=(()=>{this.hasError=!0,this.removeClass(this.refs.button,"btn-success submit-success"),this.addClass(this.refs.button,"btn-danger submit-fail"),this.removeClass(this.refs.buttonMessageContainer,"has-success"),this.addClass(this.refs.buttonMessageContainer,"has-error"),this.setContent(this.refs.buttonMessage,this.t(this.errorMessage("error")))})),"url"===this.component.action&&(this.on("requestButton",()=>{this.disabled=!0},!0),this.on("requestDone",()=>{this.loading=!1,this.disabled=!1},!0)),this.on("change",(s,e)=>{const o=e&&e.noValidate?!this.root||this.root.checkValidity(this.root.data):s.isValid;this.loading=!1,this.disabled=this.shouldDisabled||this.component.disableOnInvalid&&!o,this.setDisabled(this.refs.button,this.disabled),t&&t(s,o)},!0),this.on("error",()=>{this.loading=!1,this.disabled=!1,s&&s()},!0),this.addEventListener(this.refs.button,"click",this.onClick.bind(this)),this.disabled=this.shouldDisabled,"oauth"===this.component.action&&this.component.oauth&&this.component.oauth.authURI){const t=function(t){t=t.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");const s=new RegExp(`[\\?&]${t}=([^&#]*)`).exec(location.search);return s?decodeURIComponent(s[1].replace(/\+/g," ")):s}("iss");t&&0===this.component.oauth.authURI.indexOf(t)&&this.openOauth()}}attach(t){this.loadRefs(t,{button:"single",buttonMessageContainer:"single",buttonMessage:"single"});const s=super.attach(t);return this.attachButton(),s}detach(t){t&&this.refs.button&&this.removeShortcut(this.refs.button)}onClick(s){if(this.triggerReCaptcha(),!this.disabled&&"builder"!==this.options.attachMode)switch(this.dataValue=!0,"submit"!==this.component.action&&this.component.showValidations&&this.emit("checkValidity",this.data),this.component.action){case"saveState":case"submit":s.preventDefault(),s.stopPropagation(),this.loading=!0,this.emit("submitButton",{state:this.component.state||"submitted",component:this.component,instance:this});break;case"event":this.emit(this.interpolate(this.component.event),this.data),this.events.emit(this.interpolate(this.component.event),this.data),this.emit("customEvent",{type:this.interpolate(this.component.event),component:this.component,data:this.data,event:s});break;case"custom":{const s=this.getRoot(),e=o.flattenComponents(s.component.components,!0),i={};t.each(e,(t,e)=>{const o=s.getComponent(e);o&&(i[e]=o)}),this.evaluate(this.component.custom,{form:s,flattened:e,components:i});break}case"url":this.loading=!0,this.emit("requestButton",{component:this.component,instance:this}),this.emit("requestUrl",{url:this.interpolate(this.component.url),headers:this.component.headers});break;case"reset":this.emit("resetForm");break;case"delete":this.emit("deleteSubmission");break;case"oauth":if(this.root===this)return void console.warn("You must add the OAuth button to a form for it to function properly");if(!this.component.oauth){this.root.setAlert("danger","You must assign this button to an OAuth action before it will work.");break}if(this.component.oauth.error){this.root.setAlert("danger",`The Following Error Has Occured${this.component.oauth.error}`);break}this.openOauth(this.component.oauth)}}openOauth(){if(!this.root.formio)return void console.warn("You must attach a Form API url to your form in order to use OAuth buttons.");const t=this.component.oauth;let s={response_type:"code",client_id:t.clientId,redirect_uri:window.location.origin||`${window.location.protocol}//${window.location.host}`,state:t.state,scope:t.scope};t.display&&(s.display=t.display),s=Object.keys(s).map(t=>`${t}=${encodeURIComponent(s[t])}`).join("&");const e=`${t.authURI}?${s}`,o=window.open(e,t.provider,"width=1020,height=618"),i=setInterval(()=>{try{const s=o.location.host,e=window.location.host;if(o&&!o.closed&&s===e&&o.location.search){o.close();const s=o.location.search.substr(1).split("&").reduce((t,s)=>{const e=s.split("=");return t[e[0]]=e[1],t},{});if(s.error)return alert(s.error_description||s.error),void this.root.setAlert("danger",s.error_description||s.error);if(t.state!==s.state)return void this.root.setAlert("danger","OAuth state does not match. Please try logging in again.");const e={data:{},oauth:{}};e.oauth[t.provider]=s,e.oauth[t.provider].redirectURI=window.location.origin||`${window.location.protocol}//${window.location.host}`,this.root.formio.saveSubmission(e).then(t=>{this.root.onSubmit(t,!0)}).catch(t=>{this.root.onSubmissionError(t)})}}catch(t){"SecurityError"!==t.name&&this.root.setAlert("danger",t.message||t)}o&&!o.closed&&void 0!==o.closed||clearInterval(i)},100)}focus(){this.refs.button&&this.refs.button.focus()}triggerReCaptcha(){if(!this.root)return;const t=this.root.components.find(t=>"recaptcha"===t.component.type&&"buttonClick"===t.component.eventType&&t.component.buttonKey===this.component.key);t&&t.verify(`${this.component.key}Click`)}}});
//# sourceMappingURL=../../sourcemaps/components/button/Button.js.map

/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["../../vendors/getify/npo"],function(e){"use strict";const t=t=>{const n=(n,o,r,s,a,l)=>new e((e,i)=>{const d=new XMLHttpRequest,p="string"==typeof s,u=new FormData;if("function"==typeof l&&(d.upload.onprogress=l),!p)for(const e in s)u.append(e,s[e]);d.onload=(()=>{if(d.status>=200&&d.status<300){let t={};try{t=(t="string"==typeof d.response?JSON.parse(d.response):{})&&t.data?t.data:t}catch(e){t={}}let r=t.hasOwnProperty("url")?t.url:`${d.responseURL}/${o}`;r&&"/"===r[0]&&(r=`${n}${r}`),e({url:r,data:t})}else i(d.response||"Unable to upload file")}),d.onerror=(()=>i(d)),d.onabort=(()=>i(d));let c=n+(n.indexOf("?")>-1?"&":"?");for(const e in r)c+=`${e}=${r[e]}&`;"&"===c[c.length-1]&&(c=c.substr(0,c.length-1)),d.open("POST",c),p&&d.setRequestHeader("Content-Type","application/json");const f=t.getToken();if(f&&d.setRequestHeader("x-jwt-token",f),a){const e="string"==typeof a?JSON.parse(a):a;for(const t in e)d[t]=e[t]}d.send(p?s:u)});return{title:"Url",name:"url",uploadFile(e,o,r,s,a,l,i){const d=function(d){return n(a,o,{baseUrl:encodeURIComponent(t.projectUrl),project:d?d.project:"",form:d?d._id:""},{[i]:e,name:o,dir:r},l,s).then(n=>(n.data=n.data||{},n.data.baseUrl=t.projectUrl,n.data.project=d?d.project:"",n.data.form=d?d._id:"",{storage:"url",name:o,url:n.url,size:e.size,type:e.type,data:n.data}))};return e.private&&t.formId?t.loadForm().then(e=>d(e)):d()},deleteFile:t=>new e((e,n)=>{const o=new XMLHttpRequest;o.open("DELETE",t.url,!0),o.onload=(()=>{o.status>=200&&o.status<300?e("File deleted"):n(o.response||"Unable to delete file")}),o.send(null)}),downloadFile:o=>o.private?(t.submissionId&&o.data&&(o.data.submission=t.submissionId),n(o.url,o.name,{},JSON.stringify(o)).then(e=>e.data)):e.resolve(o)}};return t.title="Url",t});
//# sourceMappingURL=../../sourcemaps/providers/storage/url.js.map

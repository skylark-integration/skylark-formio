/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["./WebformBuilder","./Webform","./utils/builder","skylark-lodash"],function(e,t,s,o){"use strict";return class r extends e{constructor(){let e,t;arguments[0]instanceof HTMLElement||arguments[1]?(e=arguments[0],t=arguments[1]):t=arguments[0],t.skipInit=!1,super(e,t),this._form={components:[this.getPageConfig(1)]},this.page=0,this.options.hooks.attachPanel=((e,t)=>{t.refs.removeComponent&&this.addEventListener(t.refs.removeComponent,"click",()=>{const e=this.pages.findIndex(e=>e.key===t.key),s=this._form.components.findIndex(e=>e.key===t.key);-1!==e&&this.removePage(e,s)})});const s=this.options.hooks.renderComponents;this.options.hooks.renderComponents=((e,{components:t,self:o})=>"form"!==o.type||o.root?s(e,{components:t,self:o}):e);const o=this.options.hooks.attachComponents;this.options.hooks.attachComponents=((e,t,s,r)=>"form"!==r.type||r.root?o(e,t,s,r):e),this.on("saveComponent",(e,t)=>{const s=this.webform.components.map(({component:e})=>e);this._form.components.includes(t)?(this._form.components[this._form.components.indexOf(t)]=e,this.rebuild()):s.includes(t)&&(this._form.components.push(e),this.rebuild())},!0)}allowDrop(e){return!this.webform||!this.webform.refs||this.webform.refs.webform!==e}get pages(){return o.filter(this._form.components,{type:"panel"})}get currentPage(){const e=this.pages;return e&&e.length>=this.page?e[this.page]:null}set form(e){if(this._form=e,this._form.components&&Array.isArray(this._form.components)||(this._form.components=[]),0===this.pages.length){const e=this._form.components.filter(e=>"button"!==e.type);this._form.components=[this.getPageConfig(1,e)]}this.rebuild()}get form(){return this._form}get schema(){o.assign(this.currentPage,this.webform._form.components[0]);const e=new t(this.options);return e.form=this._form,e.schema}render(){return this.renderTemplate("builderWizard",{sidebar:this.renderTemplate("builderSidebar",{scrollEnabled:this.sideBarScroll,groupOrder:this.groupOrder,groupId:`builder-sidebar-${this.id}`,groups:this.groupOrder.map(e=>this.renderTemplate("builderSidebarGroup",{group:this.groups[e],groupKey:e,groupId:`builder-sidebar-${this.id}`,subgroups:this.groups[e].subgroups.map(t=>this.renderTemplate("builderSidebarGroup",{group:t,groupKey:t.key,groupId:`builder-sidebar-${e}`,subgroups:[]}))}))}),pages:this.pages,form:this.webform.render()})}attach(e){return this.loadRefs(e,{addPage:"multiple",gotoPage:"multiple"}),this.refs.addPage.forEach(e=>{this.addEventListener(e,"click",e=>{e.preventDefault(),this.addPage()})}),this.refs.gotoPage.forEach((e,t)=>{this.addEventListener(e,"click",e=>{e.preventDefault(),this.setPage(t)})}),super.attach(e)}rebuild(){const e=this.currentPage;return this.webform.form={display:"form",type:"form",components:e?[e]:[]},this.redraw()}addPage(){const e=this.pages.length+1,t=this.getPageConfig(e);return s.uniquify(this._form.components,t),this._form.components.push(t),this.emit("saveComponent",t),this.rebuild()}removePage(e,t){return this._form.components.splice(t,1),e===this.pages.length?0===e?(this._form.components.push(this.getPageConfig(1)),this.rebuild()):this.setPage(e-1):this.rebuild()}setPage(e){if(e!==this.page)return this.page=e,this.rebuild()}getPageConfig(e,t=[]){return{title:`Page ${e}`,label:`Page ${e}`,type:"panel",key:`page${e}`,components:t}}pasteComponent(e){if(!(e instanceof r))return super.pasteComponent(e)}}});
//# sourceMappingURL=sourcemaps/WizardBuilder.js.map

/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["skylark-lodash","./helpers"],function(e,t){var r=function(t,r){return e.isEqual(t,r)},o={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var o=e[t];return delete e[t],{newDocument:r,removed:o}},replace:function(e,t,r){var o=e[t];return e[t]=this.value,{newDocument:r,removed:o}},move:function(e,r,o){var n=a(o,this.path);n&&(n=t._deepClone(n));var p=i(o,{op:"remove",path:this.from}).removed;return i(o,{op:"add",path:this.path,value:p}),{newDocument:o,removed:n}},copy:function(e,r,o){var n=a(o,this.from);return i(o,{op:"add",path:this.path,value:t._deepClone(n)}),{newDocument:o}},test:function(e,t,o){return{newDocument:o,test:r(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},n={add:function(e,r,o){return t.isInteger(r)?e.splice(r,0,this.value):e[r]=this.value,{newDocument:o,index:r}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var o=e[t];return e[t]=this.value,{newDocument:r,removed:o}},move:o.move,copy:o.copy,test:o.test,_get:o._get};function a(e,t){if(""==t)return e;var r={op:"_get",path:t};return i(e,r),r.value}function i(e,i,p,h){if(void 0===p&&(p=!1),void 0===h&&(h=!0),p&&("function"==typeof p?p(i,0,e,i.path):s(i,0)),""===i.path){var c={newDocument:e};if("add"===i.op)return c.newDocument=i.value,c;if("replace"===i.op)return c.newDocument=i.value,c.removed=e,c;if("move"===i.op||"copy"===i.op)return c.newDocument=a(e,i.from),"move"===i.op&&(c.removed=e),c;if("test"===i.op){if(c.test=r(e,i.value),!1===c.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,i,e);return c.newDocument=e,c}if("remove"===i.op)return c.removed=e,c.newDocument=null,c;if("_get"===i.op)return i.value=e,c;if(p)throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",0,i,e);return c}h||(e=t._deepClone(e));var u=(i.path||"").split("/"),f=e,l=1,d=u.length,E=void 0,v=void 0,O=void 0;for(O="function"==typeof p?p:s;;){if(v=u[l],p&&void 0===E&&(void 0===f[v]?E=u.slice(0,l).join("/"):l==d-1&&(E=i.path),void 0!==E&&O(i,0,e,E)),l++,Array.isArray(f)){if("-"===v)v=f.length;else{if(p&&!t.isInteger(v))throw new t.JsonPatchError("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",0,i.path,i);t.isInteger(v)&&(v=~~v)}if(l>=d){if(p&&"add"===i.op&&v>f.length)throw new t.JsonPatchError("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",0,i.path,i);if(!1===(c=n[i.op].call(i,f,v,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,i,e);return c}}else if(v&&-1!=v.indexOf("~")&&(v=t.unescapePathComponent(v)),l>=d){if(!1===(c=o[i.op].call(i,f,v,e)).test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,i,e);return c}f=f[v]}}function p(e,r,o,n){if(void 0===n&&(n=!0),o&&!Array.isArray(r))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=t._deepClone(e));for(var a=new Array(r.length),p=0,s=r.length;p<s;p++)a[p]=i(e,r[p],o),e=a[p].newDocument;return a.newDocument=e,a}function s(e,r,n,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new t.JsonPatchError("Operation is not an object","OPERATION_NOT_AN_OBJECT",r,e,n);if(!o[e.op])throw new t.JsonPatchError("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",r,e,n);if("string"!=typeof e.path)throw new t.JsonPatchError("Operation `path` property is not a string","OPERATION_PATH_INVALID",r,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new t.JsonPatchError('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",r,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new t.JsonPatchError("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",r,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",r,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&t.hasUndefined(e.value))throw new t.JsonPatchError("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",r,e,n);if(n)if("add"==e.op){var i=e.path.split("/").length,p=a.split("/").length;if(i!==p+1&&i!==p)throw new t.JsonPatchError("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",r,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new t.JsonPatchError("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",r,e,n)}else if("move"===e.op||"copy"===e.op){var s=h([{op:"_get",path:e.from,value:void 0}],n);if(s&&"OPERATION_PATH_UNRESOLVABLE"===s.name)throw new t.JsonPatchError("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",r,e,n)}}function h(e,r,o){try{if(!Array.isArray(e))throw new t.JsonPatchError("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(r)p(t._deepClone(r),t._deepClone(e),o||!0);else{o=o||s;for(var n=0;n<e.length;n++)o(e[n],n,r,void 0)}}catch(e){if(e instanceof t.JsonPatchError)return e;throw e}}return{JsonPatchError:t.PatchError,deepClone:t._deepClone,getValueByPointer:a,applyOperation:i,applyPatch:p,applyReducer:function(e,r){var o=i(e,r);if(!1===o.test)throw new t.JsonPatchError("Test operation failed","TEST_OPERATION_FAILED",0,r,e);return o.newDocument},validator:s,validate:h}});
//# sourceMappingURL=../../sourcemaps/vendors/fast-json-patch/core.js.map

/**
 * skylark-formio - A version of formio.js that ported to running on skylarkjs.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-formio/
 * @license MIT
 */
define(["./Element","./Formio","./displays/index","./templates/index","./utils/utils","./vendors/getify/npo"],function(t,e,s,i,n,r){"use strict";class o extends t{constructor(...t){let s=t[0]instanceof HTMLElement?t[2]:t[1];e.options&&e.options.form&&(s=Object.assign(s,e.options.form)),super(s),this.ready=new r((t,e)=>{this.readyResolve=t,this.readyReject=e}),this.instance=null,t[0]instanceof HTMLElement?(this.element=t[0],this.options=t[2]||{},this.options.events=this.events,this.setForm(t[1]).then(()=>this.readyResolve(this.instance)).catch(this.readyReject)):t[0]?(this.element=null,this.options=t[1]||{},this.options.events=this.events,this.setForm(t[0]).then(()=>this.readyResolve(this.instance)).catch(this.readyReject)):(this.element=null,this.options={},this.options.events=this.events),this.display=""}create(t){return this.options&&(this.options.flatten||"flat"===this.options.renderMode)&&(t="form"),this.display=t,s.displays[t]?new s.displays[t](this.element,this.options):new s.displays.webform(this.element,this.options)}set form(t){return this.setForm(t)}errorForm(t){return{components:[{label:"HTML",tag:"div",className:"error error-message alert alert-danger ui red message",attrs:[{attr:"role",value:"alert"}],key:"errorMessage",type:"htmlelement",input:!1,content:"string"==typeof t?t:t.message}]}}setForm(t){let s;if("string"==typeof(t=t||this.form)){const i=new e(t);let n;s=this.getSubmission(i).catch(t=>{n=t}).then(e=>i.loadForm().catch(t=>{n=t}).then(s=>{if(n&&(s=this.errorForm(n)),this.instance=this.instance||this.create(s.display),this.instance.url=t,this.instance.nosubmit=!1,this._form=this.instance.form=s,e&&(this.instance.submission=e),n)throw n;return this.instance}))}else this.instance=this.instance||this.create(t.display),this._form=this.instance.form=t,s=this.instance.ready;return s.then(()=>(this.element=this.instance.element,this.instance))}getSubmission(t){return t.submissionId?t.loadSubmission():r.resolve()}get form(){return this._form}setDisplay(t){return this.display===t&&this.instance?r.resolve(this.instance):(this.form.display=t,this.instance.destroy(),this.instance=this.create(t),this.setForm(this.form))}empty(){if(this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild)}static embed(t){return new r(e=>{t&&t.src||e();const s=this.id||`formio-${Math.random().toString(36).substring(7)}`,i=t.class||"formio-form-wrapper";let n=t.styles?`<link rel="stylesheet" href="${t.styles}">`:"";n+=`<div id="${s}" class="${i}"></div>`,document.write(n);let r=0;const h=setInterval(()=>{r++;const i=document.getElementById(s);(i||r>10)&&(e(new o(i,t.src).ready),clearInterval(h))},10)})}sanitize(t){return n.sanitize(t,this.options)}setContent(t,e){return t instanceof HTMLElement&&(t.innerHTML=this.sanitize(e),!0)}build(){if(!this.instance)return r.reject("Form not ready. Use form.ready promise");if(!this.element)return r.reject("No DOM element for form.");const t=this.options&&this.options.template?this.options.template:"bootstrap",e=i[t].loader||i.bootstrap.loader;return this.setContent(this.element,e.form),this.render().then(t=>(this.setContent(this.element,t),this.attach(this.element).then(()=>this.instance))).then(t=>(this.emit("build",t),t))}render(){return this.instance?r.resolve(this.instance.render()).then(t=>(this.emit("render",t),t)):r.reject("Form not ready. Use form.ready promise")}attach(t){return this.instance?(this.element=t,this.instance.attach(this.element).then(t=>(this.emit("attach",t),t))):r.reject("Form not ready. Use form.ready promise")}}return e.embedForm=(t=>o.embed(t)),e.createForm=((...t)=>new o(...t).ready),e.Form=o});
//# sourceMappingURL=sourcemaps/Form.js.map
